// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.15/esri/copyright.txt for details.

define(["require","exports","../../../../core/tsSupport/decorateHelper","../../../../core/tsSupport/declareExtendsHelper","../../../../Color","../../../../core/colorUtils","../../../../core/compilerUtils","../../../../core/handleUtils","../../../../core/JSONSupport","../../../../core/watchUtils","../../../../core/accessorSupport/decorators","../../../../core/libs/gl-matrix-2/vec4f64","../../webgl-engine/materials/lineStippleUtils"],(function(e,o,t,r,n,l,i,p,s,a,u,c,d){Object.defineProperty(o,"__esModule",{value:!0}),o.colors={main:new n([255,127,0]),selected:new n([255,255,255]),outline:new n([0,0,0,.5]),selectedOutline:new n([255,255,255])};function y(e,o){var t=e.clone();return t.a*=o,t}function h(e,o){var t=e.clone(),r=l.toHSV(t);r.s*=o;var n=l.toRGB(r);return t.r=n.r,t.g=n.g,t.b=n.b,t}var w=function(e){function l(t){var r=e.call(this,t)||this;return r.color=o.colors.main,r.height=90,r.coneHeight=40,r.coneWidth=23,r.width=3,r.occludedMode="always",r.enabled="always",r}return r(l,e),Object.defineProperty(l.prototype,"occludedFlag",{get:function(){return A(this.occludedMode)},enumerable:!0,configurable:!0}),t([u.property({type:n,nonNullable:!0,json:{write:!0}})],l.prototype,"color",void 0),t([u.property({type:Number,nonNullable:!0,range:{min:1,max:200,step:1},json:{write:!0}})],l.prototype,"height",void 0),t([u.property({type:Number,nonNullable:!0,range:{min:1,max:60,step:1},json:{write:!0}})],l.prototype,"coneHeight",void 0),t([u.property({type:Number,nonNullable:!0,range:{min:1,max:60,step:1},json:{write:!0}})],l.prototype,"coneWidth",void 0),t([u.property({type:Number,range:{min:0,max:16,step:.5},json:{write:!0}})],l.prototype,"width",void 0),t([u.property({type:["always","transparent","always-transparent"],json:{write:!0}})],l.prototype,"occludedMode",void 0),t([u.property({type:["always","not-grab-z"],json:{write:!0},nonNullable:!0})],l.prototype,"enabled",void 0),l=t([u.subclass("esri.views.3d.interactive.editingTools.settings.ZManipulatorStyle")],l)}(u.declared(s.JSONSupport)),b=function(e){function l(t){var r=e.call(this,t)||this;return r.size=11,r.outlineSize=1,r.collisionPadding=9,r.color=o.colors.main,r.outlineColor=o.colors.outline,r.occludedMode="always",r.hoverOutlineColor=o.colors.selectedOutline,r}return r(l,e),Object.defineProperty(l.prototype,"renderOccludedFlag",{get:function(){return A(this.occludedMode)},enumerable:!0,configurable:!0}),l.prototype.bindOccludedMode=function(e){var o=this;return a.init(this,"occludedMode",(function(){return e.renderOccluded=o.renderOccludedFlag}))},l.prototype.bindColorMaterial=function(e,o){return p.handlesGroup([a.init(this,e,(function(t){o.setParameterValues({color:z(t),transparent:"color"!==e||t.a<1})})),this.bindOccludedMode(o)])},t([u.property({type:Number,nonNullable:!0,range:{min:1,max:32,step:.5},json:{write:!0}})],l.prototype,"size",void 0),t([u.property({type:Number,nonNullable:!0,range:{min:0,max:32,step:.5},json:{write:!0}})],l.prototype,"outlineSize",void 0),t([u.property({type:Number,nonNullable:!0,range:{min:0,max:32,step:.5},json:{write:!0}})],l.prototype,"collisionPadding",void 0),t([u.property({type:n,nonNullable:!0,json:{write:!0}})],l.prototype,"color",void 0),t([u.property({type:n,nonNullable:!0,json:{write:!0}})],l.prototype,"outlineColor",void 0),t([u.property({type:["always","transparent"],json:{write:!0}})],l.prototype,"occludedMode",void 0),t([u.property({type:n,nonNullable:!0,json:{write:!0}})],l.prototype,"hoverOutlineColor",void 0),l=t([u.subclass("esri.views.3d.interactive.editingTools.settings.VertexManipulatorStyle")],l)}(u.declared(s.JSONSupport)),g=function(e){function n(t){var r=e.call(this,t)||this;return r.vertex=new b({color:o.colors.main,outlineColor:o.colors.outline}),r.edge=new b({color:h(y(o.colors.main,2/3),.5),outlineColor:y(o.colors.outline,.5),size:8,collisionPadding:8}),r.selected=new b({color:o.colors.selected,outlineColor:o.colors.outline}),r}return r(n,e),t([u.property({type:b,nonNullable:!0,constructOnly:!0,json:{write:!0}})],n.prototype,"vertex",void 0),t([u.property({type:b,nonNullable:!0,constructOnly:!0,json:{write:!0}})],n.prototype,"edge",void 0),t([u.property({type:b,nonNullable:!0,constructOnly:!0,json:{write:!0}})],n.prototype,"selected",void 0),n=t([u.subclass("esri.views.3d.interactive.editingTools.settings.ReshapeManipulators")],n)}(u.declared(s.JSONSupport)),v=function(e){function l(t){var r=e.call(this,t)||this;return r.color=o.colors.selected,r.width=1.5,r.stipplePattern="5-5",r.stippleOffColor=o.colors.outline,r.falloff=0,r.innerWidth=1.5,r.innerColor=o.colors.selected,r.occludedMode="transparent",r.occludedLayer="default",r}return r(l,e),l.prototype.bindStyle=function(e){var o=this;return p.handlesGroup([M(this,"color",e,"color",z),M(this,"width",e,"width",P),M(this,"stipplePattern",e,"stipplePattern",W),M(this,"stippleOffColor",e,"stippleOffColor",z),M(this,"falloff",e,"falloff",P),M(this,"innerWidth",e,"innerWidth",P),M(this,"innerColor",e,"innerColor",z),M(this,"occludedMode",e,"occludedMode",(function(e){return A(e,{layer:o.occludedLayer})}))])},t([u.property({type:n,nonNullable:!0,json:{write:!0}})],l.prototype,"color",void 0),t([u.property({type:Number,nonNullable:!0,range:{min:0,max:32,step:.5},json:{write:!0}})],l.prototype,"width",void 0),t([u.property({type:String,json:{write:!0,default:null}})],l.prototype,"stipplePattern",void 0),t([u.property({type:n,nonNullable:!0,json:{write:!0}})],l.prototype,"stippleOffColor",void 0),t([u.property({type:Number,nonNullable:!0,range:{min:0,max:16,step:.5},json:{write:!0}})],l.prototype,"falloff",void 0),t([u.property({type:Number,nonNullable:!0,range:{min:0,max:16,step:.5},json:{write:!0}})],l.prototype,"innerWidth",void 0),t([u.property({type:n,nonNullable:!0,json:{write:!0}})],l.prototype,"innerColor",void 0),t([u.property({type:["always","transparent"],json:{write:!0}})],l.prototype,"occludedMode",void 0),t([u.property({type:["default","foreground"],json:{write:!0}})],l.prototype,"occludedLayer",void 0),l=t([u.subclass("esri.views.3d.interactive.editingTools.settings.LineStyle")],l)}(u.declared(s.JSONSupport)),f=function(e){function l(t){var r=e.call(this,t)||this;return r.color=o.colors.selected,r.size=4,r.outlineSize=1,r.outlineColor=o.colors.outline,r.shape="square",r}return r(l,e),l.prototype.bindStyle=function(e){return p.handlesGroup([M(this,"color",e,"color",z),M(this,"size",e,"size",P),M(this,"outlineSize",e,"outlineSize",P),M(this,"outlineColor",e,"outlineColor",z),M(this,"shape",e,"primitive",P)])},t([u.property({type:n,nonNullable:!0,json:{write:!0}})],l.prototype,"color",void 0),t([u.property({type:Number,nonNullable:!0,range:{min:0,max:32,step:.5},json:{write:!0}})],l.prototype,"size",void 0),t([u.property({type:Number,nonNullable:!0,range:{min:0,max:32,step:.5},json:{write:!0}})],l.prototype,"outlineSize",void 0),t([u.property({type:n,nonNullable:!0,json:{write:!0}})],l.prototype,"outlineColor",void 0),t([u.property({type:["circle","square","kite","cross","x","triangle"],nonNullable:!0,json:{write:!0}})],l.prototype,"shape",void 0),l=t([u.subclass("esri.views.3d.interactive.editingTools.settings.PointStyle")],l)}(u.declared(s.JSONSupport)),m=function(e){function l(t){var r=e.call(this,t)||this;return r.innerColor=o.colors.selected,r.innerWidth=1,r.glowColor=o.colors.main,r.glowWidth=8,r.glowFalloff=8,r.globalAlpha=.3,r.globalAlphaContrastBoost=1.5,r.radius=3,r.heightFillColor=o.colors.main,r}return r(l,e),l.prototype.bindStyle=function(e){var o=this,t=1,r=function(){var r={glowColor:n.toUnitRGB(o.glowColor),glowFalloff:o.glowFalloff,glowWidth:o.glowWidth,innerColor:n.toUnitRGB(o.innerColor),innerWidth:o.innerWidth,globalAlpha:o.globalAlpha*t,globalAlphaContrastBoost:o.globalAlphaContrastBoost,intersectsLineRadius:o.radius,heightPlaneFillColor:n.toUnitRGBA(o.heightFillColor)};"style"in e?e.style=r:e.laserlineStyle=r};r();var l=this.watch(this.keys(),r);return{updateGlobalAlpha:function(e){e!==t&&(t=e,r())},remove:function(){l.remove()}}},t([u.property({type:n,nonNullable:!0,json:{write:!0}})],l.prototype,"innerColor",void 0),t([u.property({type:Number,nonNullable:!0,range:{min:0,max:16,step:.5},json:{write:!0}})],l.prototype,"innerWidth",void 0),t([u.property({type:n,nonNullable:!0,json:{write:!0}})],l.prototype,"glowColor",void 0),t([u.property({type:Number,nonNullable:!0,range:{min:0,max:16,step:.5},json:{write:!0}})],l.prototype,"glowWidth",void 0),t([u.property({type:Number,nonNullable:!0,range:{min:0,max:16,step:.5},json:{write:!0}})],l.prototype,"glowFalloff",void 0),t([u.property({type:Number,nonNullable:!0,range:{min:0,max:1,step:.01},json:{write:!0}})],l.prototype,"globalAlpha",void 0),t([u.property({type:Number,nonNullable:!0,range:{min:0,max:10,step:.25},json:{write:!0}})],l.prototype,"globalAlphaContrastBoost",void 0),t([u.property({type:Number,nonNullable:!0,range:{min:0,max:16,step:.05},json:{write:!0}})],l.prototype,"radius",void 0),t([u.property({type:n,nonNullable:!0,json:{write:!0}})],l.prototype,"heightFillColor",void 0),l=t([u.subclass("esri.views.3d.interactive.editingTools.settings.LaserlineStyle")],l)}(u.declared(s.JSONSupport)),N=function(e){function n(t){var r=e.call(this,t)||this;return r.outline=new v({color:o.colors.selected,occludedMode:"transparent",occludedLayer:"foreground",stippleOffColor:o.colors.outline,stipplePattern:"5-5",width:1.5}),r.outlineEnabled=!0,r.shadowStyle=new m({globalAlpha:.3,glowColor:o.colors.main,glowFalloff:8,glowWidth:8,innerColor:o.colors.selected,innerWidth:1}),r.shadowEnabled="always",r}return r(n,e),t([u.property({type:v,constructOnly:!0,nonNullable:!0,json:{write:!0}})],n.prototype,"outline",void 0),t([u.property({type:Boolean,nonNullable:!0,json:{write:!0}})],n.prototype,"outlineEnabled",void 0),t([u.property({type:m,json:{write:!0}})],n.prototype,"shadowStyle",void 0),t([u.property({type:["never","always","grab-xy"],nonNullable:!0,json:{write:!0}})],n.prototype,"shadowEnabled",void 0),n=t([u.subclass("esri.views.3d.interactive.editingTools.settings.LineGraphics")],n)}(u.declared(s.JSONSupport)),j=function(e){function n(t){var r=e.call(this,t)||this;return r.outline=new f({color:o.colors.selected,outlineColor:o.colors.outline,outlineSize:1,shape:"circle",size:4}),r.outlineEnabled=!0,r.shadowStyle=new m({globalAlpha:.3,glowColor:o.colors.main,glowFalloff:1.5,glowWidth:6,innerColor:o.colors.selected,innerWidth:1,radius:2}),r.shadowEnabled="always",r}return r(n,e),t([u.property({type:f,constructOnly:!0,nonNullable:!0,json:{write:!0}})],n.prototype,"outline",void 0),t([u.property({type:Boolean,nonNullable:!0,json:{write:!0}})],n.prototype,"outlineEnabled",void 0),t([u.property({type:m,json:{write:!0}})],n.prototype,"shadowStyle",void 0),t([u.property({type:["never","always","grab-xy"],nonNullable:!0,json:{write:!0}})],n.prototype,"shadowEnabled",void 0),n=t([u.subclass("esri.views.3d.interactive.editingTools.settings.PointGraphics")],n)}(u.declared(s.JSONSupport)),C=function(e){function o(o){var t=e.call(this,o)||this;return t.enabled="always",t}return r(o,e),t([u.property({type:["never","always","grab-z"],nonNullable:!0,json:{write:!0}})],o.prototype,"enabled",void 0),o=t([u.subclass("esri.views.3d.interactive.editingTools.settings.HeightPlane")],o)}(u.declared(m)),S=function(e){function o(o){var t=e.call(this,o)||this;return t.enabled="always",t.infinite="ground",t}return r(o,e),Object.defineProperty(o.prototype,"infiniteType",{get:function(){switch(this.infinite){case"single":return 1;case"double":return 2;case"ground":return 3;default:return i.neverReached(this.infinite),1}},enumerable:!0,configurable:!0}),t([u.property({type:["never","always","grab-z","grab-xy","grab"],nonNullable:!0,json:{write:!0}})],o.prototype,"enabled",void 0),t([u.property({type:["single","double","ground"],nonNullable:!0,json:{write:!0}})],o.prototype,"infinite",void 0),o=t([u.subclass("esri.views.3d.interactive.editingTools.settings.ZVerticalLine")],o)}(u.declared(v)),O=function(e){function n(t){var r=e.call(this,t)||this;return r.lineGraphics=new N,r.pointGraphics=new j,r.heightPlane=new C({globalAlpha:.3,glowColor:o.colors.main,glowFalloff:8,glowWidth:8,innerColor:o.colors.selected,innerWidth:1}),r.heightBox=new C({globalAlpha:.3,glowColor:o.colors.main,glowFalloff:8,glowWidth:8,innerColor:o.colors.selected,innerWidth:0,heightFillColor:o.colors.main}),r.zVerticalLine=new S({color:y(o.colors.main,.5),falloff:2,innerColor:y(o.colors.selected,0),occludedMode:"transparent",stipplePattern:null,width:5,infinite:"ground"}),r.laserlineAlphaMultiplier=1.5,r.heightPlaneAngleCutoff=20,r}return r(n,e),t([u.property({type:N,constructOnly:!0,nonNullable:!0,json:{write:!0}})],n.prototype,"lineGraphics",void 0),t([u.property({type:j,constructOnly:!0,nonNullable:!0,json:{write:!0}})],n.prototype,"pointGraphics",void 0),t([u.property({type:C,constructOnly:!0,nonNullable:!0,json:{write:!0}})],n.prototype,"heightPlane",void 0),t([u.property({type:C,constructOnly:!0,nonNullable:!0,json:{write:!0}})],n.prototype,"heightBox",void 0),t([u.property({type:S,constructOnly:!0,nonNullable:!0,json:{write:!0}})],n.prototype,"zVerticalLine",void 0),t([u.property({type:Number,nonNullable:!0,range:{min:1,max:2,step:.1},json:{write:!0}})],n.prototype,"laserlineAlphaMultiplier",void 0),t([u.property({type:Number,nonNullable:!0,range:{min:0,max:45,step:1},json:{write:!0}})],n.prototype,"heightPlaneAngleCutoff",void 0),n=t([u.subclass("esri.views.3d.interactive.editingTools.settings.VisualElements")],n)}(u.declared(s.JSONSupport)),x=function(e){function o(o){var t=e.call(this,o)||this;return t.visualElements=new O,t.reshapeManipulators=new g,t.zManipulator=new w,t}return r(o,e),o.prototype.colorToVec4=function(e){return z(e)},t([u.property({type:O,constructOnly:!0,nonNullable:!0,json:{write:!0}})],o.prototype,"visualElements",void 0),t([u.property({type:g,constructOnly:!0,nonNullable:!0,json:{write:!0}})],o.prototype,"reshapeManipulators",void 0),t([u.property({type:w,constructOnly:!0,nonNullable:!0,json:{write:!0}})],o.prototype,"zManipulator",void 0),o=t([u.subclass("esri.views.3d.interactive.editingTools.settings.Settings")],o)}(u.declared(s.JSONSupport));function M(e,o,t,r,n){return a.init(e,o,(function(e){t[r]=n?n(e):e}))}function P(e){return e}function z(e){return c.vec4f64.fromArray(n.toUnitRGBA(e))}function W(e){if(!e)return null;var o=e.split(/[^0-9]/).map((function(e){return parseFloat(e)}));return d.createStipplePattern(o)}function A(e,o){var t=o&&"foreground"===o.layer;switch(e){case"always":return t?32:16;case"transparent":return t?8:4;case"always-transparent":return 2;default:i.neverReached(e)}return 1}o.settings=new x}));