// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.15/esri/copyright.txt for details.

define(["require","exports","../../../../../core/tsSupport/decorateHelper","../../../../../core/tsSupport/extendsHelper","../../../../../core/tsSupport/generatorHelper","../../../../../core/tsSupport/awaiterHelper","../../../../../core/Handles","../../../../../core/handleUtils","../../../../../core/has","../../../../../core/maybe","./config","./Manipulation","./MoveXYAxisManipulation","./MoveXYDiscManipulation","./MoveZManipulation"],(function(e,i,n,t,a,r,o,u,l,p,s,c,h,y,d){Object.defineProperty(i,"__esModule",{value:!0});var f=function(e){function i(i){var n=e.call(this)||this;n._handles=new o,n._angleDeferred=null,n._interactive=!0;var t=i.tool,a=i.view,r=i.snapToScene,u=i.radius;return n._view=a,n.xyManipulation=new y.MoveXYDiscManipulation({tool:t,view:a,snapToScene:r,radius:u}),n.xyAxisManipulation=new h.MoveXYAxisManipulation({tool:t,view:a,radius:u}),n.zManipulation=new d.MoveZManipulation({tool:t,view:a,radius:u}),n.xyManipulation.available=i.xyAvailable,n.xyAxisManipulation.available=i.xyAxisAvailable,n.zManipulation.available=i.zAvailable,n.autoHideXYAxis(),n.forEachManipulator((function(e){n._handles.add(e.events.on("grab-changed",(function(){return n.updateManipulatorInteractivity()})))})),n}return t(i,e),i.prototype.destroy=function(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()},i.prototype.createGraphicDragPipeline=function(e,i){return u.handlesGroup([this.xyManipulation.createGraphicDragPipeline(e,i),this.xyAxisManipulation.createGraphicDragPipeline(e,i),this.zManipulation.createGraphicDragPipeline(e,i)])},i.prototype.createDragPipeline=function(e,i,n){return u.handlesGroup([this.xyManipulation.createDragPipeline(e,i,n),this.xyAxisManipulation.createDragPipeline(e,i,n),this.zManipulation.createDragPipeline(e,n)])},Object.defineProperty(i.prototype,"snapToScene",{set:function(e){this.xyManipulation.snapToScene=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"angle",{set:function(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"angleDeferred",{set:function(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"interactive",{set:function(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"radius",{set:function(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayScale",{set:function(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e},enumerable:!0,configurable:!0}),i.prototype.forEachManipulator=function(e){this.xyManipulation.forEachManipulator((function(i){return e(i,1)})),this.xyAxisManipulation.forEachManipulator((function(i){return e(i,1)})),this.zManipulation.forEachManipulator((function(i){return e(i,0)}))},Object.defineProperty(i.prototype,"xyAxisVisible",{get:function(){var e=this.xyManipulation.someManipulator((function(e){return e.focused}))||this.xyAxisManipulation.someManipulator((function(e){return e.focused}));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e},enumerable:!0,configurable:!0}),i.prototype.autoHideXYAxis=function(){var e=this,i=this.xyAxisManipulation,n=this.xyManipulation;if(!l("esri-mobile")){var t=[];n.forEachManipulator((function(e){return t.push(e)})),i.forEachManipulator((function(e){return t.push(e)}));for(var a=function(){var n=[];e.xyAxisVisible?p.isSome(e._angleDeferred)&&(e.angle=e._angleDeferred()):i.forEachManipulator((function(e){return n.push(e.disableDisplay())})),e._handles.remove(M),e._handles.add(n,M)},r=0,o=t;r<o.length;r++){var u=o[r];this._handles.add(u.events.on("focus-changed",a))}this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",a)),a()}},i.prototype.updateManipulatorInteractivity=function(){var e=this,i=this.grabbing;this.forEachManipulator((function(n){n.interactive=!i&&e._interactive||n.grabbing}))},i.radiusForSymbol=function(e){var i=p.isSome(e)&&"point-3d"===e.type&&e.symbolLayers;return!!i&&i.length>0&&i.some((function(e){return"icon"===e.type}))?s.DISC_RADIUS_SMALL:s.DISC_RADIUS},i}(c.Manipulation);i.MoveManipulation=f;var M="disable-xy-axis-display"}));