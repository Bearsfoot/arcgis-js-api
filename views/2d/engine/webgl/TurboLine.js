// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.15/esri/copyright.txt for details.

define(["require","exports","../../../../symbols/cim/enums","./mesh/templates/util"],(function(t,e,r,i){Object.defineProperty(e,"__esModule",{value:!0});var n,x=function(){this.closed=void 0,this.isFirstVertex=void 0,this.isLastVertex=void 0,this.isCap=void 0,this.currentVertex={x:void 0,y:void 0},this.inbound={x:void 0,y:void 0},this.outbound={x:void 0,y:void 0},this.prevNormal={x:void 0,y:void 0},this.nextNormal={x:void 0,y:void 0},this.bisector={x:void 0,y:void 0},this.leftInner={x:void 0,y:void 0},this.rightInner={x:void 0,y:void 0},this.leftOuter={x:void 0,y:void 0},this.rightOuter={x:void 0,y:void 0}};function o(){if(b.cosine<d.innerBisectorAutoSplitThreshold){b.splitInner=!0,b.gapInner=!0;var t=Math.max(d.innerBisectorAutoSplitThreshold,b.cosine),e=Math.sqrt(1-t*t)/t;b.leftInner.x=b.nextNormal.x+b.sign*e*b.outbound.x,b.leftInner.y=b.nextNormal.y+b.sign*e*b.outbound.y,b.rightInner.x=b.prevNormal.x-b.sign*e*b.inbound.x,b.rightInner.y=b.prevNormal.y-b.sign*e*b.inbound.y}else d.enableInnerBisectorSplit&&(b.splitInner=!0,b.gapInner=!1,b.leftInner.x=b.rightInner.x=b.bisector.x/b.cosine,b.leftInner.y=b.rightInner.y=b.bisector.y/b.cosine);if(b.cosine<d.outerBisectorAutoSplitThreshold){b.splitOuter=!0,b.gapOuter=!0;t=Math.max(d.outerBisectorAutoSplitThreshold,b.cosine),e=Math.sqrt(1-t*t)/t;b.leftOuter.x=b.prevNormal.x-b.sign*e*b.inbound.x,b.leftOuter.y=b.prevNormal.y-b.sign*e*b.inbound.y,b.rightOuter.x=b.nextNormal.x+b.sign*e*b.outbound.x,b.rightOuter.y=b.nextNormal.y+b.sign*e*b.outbound.y}else d.enableOuterBisectorSplit&&(b.splitOuter=!0,b.gapOuter=!1,b.leftOuter.x=b.rightOuter.x=b.bisector.x/b.cosine,b.leftOuter.y=b.rightOuter.y=b.bisector.y/b.cosine)}e.TessellationState=x,e.tessellate=function(t,e,r){d.trackDistance=null!=e.trackDistance&&e.trackDistance,d.wrapDistance=null!=e.wrapDistance?e.wrapDistance:65535,d.thin=null!=e.thin&&e.thin,d.initialDistance=null!=e.initialDistance?e.initialDistance:0,d.enableOuterBisectorSplit=null!=e.enableOuterBisectorSplit&&e.enableOuterBisectorSplit,d.outerBisectorAutoSplitThreshold=null!=e.outerBisectorAutoSplitThreshold?e.outerBisectorAutoSplitThreshold:0,d.enableInnerBisectorSplit=null!=e.enableOuterBisectorSplit&&e.enableOuterBisectorSplit,d.innerBisectorAutoSplitThreshold=null!=e.innerBisectorAutoSplitThreshold?e.innerBisectorAutoSplitThreshold:0,n=t,s=r,h=0,u=0,l=0,c=!1,y=null,a=null,b.currentVertex.x=null,b.currentVertex.y=null,b.distance=d.initialDistance;var i=n[0],x=n[n.length-1];b.canSplit=!1,b.closed=i.x===x.x&&i.y===x.y,n.length<2||2===n.length&&b.closed||(d.thin?d.trackDistance?function(){p(),V(),E(1);for(;u-l>d.wrapDistance||h<n.length;)p(),V(),E(2),s.bridge(b),b.leftExit0=b.rightExit0,b.leftExit2=b.rightExit2}():function(){for(;h<n.length;){if(h>0&&(b.inbound.x=b.outbound.x,b.inbound.y=b.outbound.y),h<n.length-1){b.outbound.x=n[h+1].x-n[h].x,b.outbound.y=n[h+1].y-n[h].y;var t=Math.sqrt(b.outbound.x*b.outbound.x+b.outbound.y*b.outbound.y);b.distance+=t,b.outbound.x/=t,b.outbound.y/=t}else b.outbound.x=b.inbound.x,b.outbound.y=b.inbound.y;0===h&&(b.inbound.x=b.outbound.x,b.inbound.y=b.outbound.y),b.currentVertex.x=n[h].x,b.currentVertex.y=n[h].y,b.prevNormal.x=-b.inbound.y,b.prevNormal.y=b.inbound.x,b.nextNormal.x=-b.outbound.y,b.nextNormal.y=b.outbound.x,0===h?(s.vertex(b),b.leftEntry0=b.entry0,b.leftEntry2=b.entry2,b.leftExit0=b.exit0,b.leftExit2=b.exit2):(s.vertex(b),b.rightEntry0=b.entry0,b.rightEntry2=b.entry2,b.rightExit0=b.exit0,b.rightExit2=b.exit2,s.bridge(b),b.leftExit0=b.rightExit0,b.leftExit2=b.rightExit2),++h}}():d.enableOuterBisectorSplit||d.outerBisectorAutoSplitThreshold>0||d.enableInnerBisectorSplit||d.innerBisectorAutoSplitThreshold>0?(b.canSplit=!0,function(){p(),g(),b.splitInner=b.gapInner=b.splitOuter=b.gapOuter=!1,f(1),b.closure0=b.leftEntry0,b.closure1=b.leftEntry1,b.closure2=b.leftEntry2;for(;u-l>d.wrapDistance||h<n.length-1||h<n.length&&(!b.closed||d.trackDistance);)p(),g(),b.splitInner=b.gapInner=b.splitOuter=b.gapOuter=!1,f(2),s.bridge(b),b.leftExit0=b.rightExit0,b.leftExit1=b.rightExit1,b.leftExit2=b.rightExit2;b.closed&&!d.trackDistance&&(b.rightEntry0=b.closure0,b.rightEntry1=b.closure1,b.rightEntry2=b.closure2,s.bridge(b),b.leftExit0=b.rightExit0,b.leftExit1=b.rightExit1,b.leftExit2=b.rightExit2)}()):function(){p(),g(),f(1),b.closure0=b.leftEntry0,b.closure1=b.leftEntry1,b.closure2=b.leftEntry2;for(;u-l>d.wrapDistance||h<n.length-1||h<n.length&&(!b.closed||d.trackDistance);)p(),g(),f(2),s.bridge(b),b.leftExit0=b.rightExit0,b.leftExit1=b.rightExit1,b.leftExit2=b.rightExit2;b.closed&&!d.trackDistance&&(b.rightEntry0=b.closure0,b.rightEntry1=b.closure1,b.rightEntry2=b.closure2,s.bridge(b),b.leftExit0=b.rightExit0,b.leftExit1=b.rightExit1,b.leftExit2=b.rightExit2)}())},e.cleanup=function(){n=null,s=null},e.splitVertex=o;var s,u,l,c,y,a,d={},h=void 0,b=new x;function p(){if(c)return b.distance=0,b.isCap=b.isFirstVertex=b.isLastVertex=!1,void(c=!1);if(0===u)if(b.isFirstVertex=0===h,a=n[h],0===h){if(u=0,b.closed){b.inbound.x=a.x-n[n.length-2].x,b.inbound.y=a.y-n[n.length-2].y;var t=Math.sqrt(b.inbound.x*b.inbound.x+b.inbound.y*b.inbound.y);b.inbound.x/=t,b.inbound.y/=t}}else b.inbound.x=a.x-y.x,b.inbound.y=a.y-y.y,u=Math.sqrt(b.inbound.x*b.inbound.x+b.inbound.y*b.inbound.y),b.inbound.x/=u,b.inbound.y/=u;if(b.distance+u-l<=d.wrapDistance){if(h<n.length-1){b.outbound.x=n[h+1].x-a.x,b.outbound.y=n[h+1].y-a.y;var e=Math.sqrt(b.outbound.x*b.outbound.x+b.outbound.y*b.outbound.y);b.outbound.x/=e,b.outbound.y/=e}else if(b.closed){b.outbound.x=n[1].x-a.x,b.outbound.y=n[1].y-a.y;e=Math.sqrt(b.outbound.x*b.outbound.x+b.outbound.y*b.outbound.y);b.outbound.x/=e,b.outbound.y/=e}else b.outbound.x=b.inbound.x,b.outbound.y=b.inbound.y;return 0!==h||b.closed||(b.inbound.x=b.outbound.x,b.inbound.y=b.outbound.y),++h,b.isLastVertex=h===n.length,b.isCap=!b.closed&&(b.isFirstVertex||b.isLastVertex),b.distance+=u-l,u=0,l=0,c=b.distance+u-l===d.wrapDistance,b.currentVertex.x=a.x,b.currentVertex.y=a.y,y=a,void(a=null)}b.outbound.x=b.inbound.x,b.outbound.y=b.inbound.y,l+=d.wrapDistance-b.distance,b.distance=d.wrapDistance,c=!0;var r=l/u;b.currentVertex.x=(1-r)*y.x+r*a.x,b.currentVertex.y=(1-r)*y.y+r*a.y}function V(){b.prevNormal.x=-b.inbound.y,b.prevNormal.y=b.inbound.x,b.nextNormal.x=-b.outbound.y,b.nextNormal.y=b.outbound.x}function g(){V(),b.bisector.x=b.prevNormal.x+b.nextNormal.x,b.bisector.y=b.prevNormal.y+b.nextNormal.y;var t=Math.sqrt(b.bisector.x*b.bisector.x+b.bisector.y*b.bisector.y);if(t<.001)return b.bisector.x=void 0,b.bisector.y=void 0,b.cosine=0,void(b.sign=void 0);b.bisector.x/=t,b.bisector.y/=t,b.cosine=b.bisector.x*b.nextNormal.x+b.bisector.y*b.nextNormal.y,b.sign=b.prevNormal.x*b.nextNormal.y-b.prevNormal.y*b.nextNormal.x>=0?1:-1}function f(t){s.vertex(b),1===t?(b.leftEntry0=b.entry0,b.leftEntry1=b.entry1,b.leftEntry2=b.entry2,b.leftExit0=b.exit0,b.leftExit1=b.exit1,b.leftExit2=b.exit2):2===t&&(b.rightEntry0=b.entry0,b.rightEntry1=b.entry1,b.rightEntry2=b.entry2,b.rightExit0=b.exit0,b.rightExit1=b.exit1,b.rightExit2=b.exit2)}function E(t){s.vertex(b),1===t?(b.leftEntry0=b.entry0,b.leftEntry2=b.entry2,b.leftExit0=b.exit0,b.leftExit2=b.exit2):2===t&&(b.rightEntry0=b.entry0,b.rightEntry2=b.entry2,b.rightExit0=b.exit0,b.rightExit2=b.exit2)}var v=function(){function t(t,e){this.writeVertex=t,this.writeTriangle=e,this.capType=r.CapType.BUTT,this.joinType=r.JoinType.MITER,this.miterLimitCosine=i.getLimitCosine(2),this.roundLimitCosine=Math.cos(23*Math.PI/180),this.almostParallelCosine=.97,this.radsPerSlice=.8,this.textured=!1,this.joinOnUTurn=!1}return t.prototype.vertex=function(t){var e=this.joinType===r.JoinType.MITER?this.miterLimitCosine:this.roundLimitCosine,i=t.isCap&&this.capType!==r.CapType.BUTT,n=!1;t.cosine>this.almostParallelCosine?(t.exit0=t.entry0=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,t.bisector.x/t.cosine,t.bisector.y/t.cosine,0,-1,t.distance),t.exit2=t.entry2=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,-t.bisector.x/t.cosine,-t.bisector.y/t.cosine,0,1,t.distance)):t.cosine<1-this.almostParallelCosine?(n=!t.isCap&&this.joinOnUTurn,t.entry0=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,t.prevNormal.x,t.prevNormal.y,0,-1,t.distance),t.entry2=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,-t.prevNormal.x,-t.prevNormal.y,0,1,t.distance),t.exit0=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,t.nextNormal.x,t.nextNormal.y,0,-1,t.distance),t.exit2=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,-t.nextNormal.x,-t.nextNormal.y,0,1,t.distance)):t.canSplit?(o(),t.sign>0?(t.splitInner?(t.exit0=this.writeVertex(t.currentVertex.x,t.currentVertex.y,t.outbound.x,t.outbound.y,t.leftInner.x,t.leftInner.y,0,-1,t.distance),t.entry0=this.writeVertex(t.currentVertex.x,t.currentVertex.y,t.inbound.x,t.inbound.y,t.rightInner.x,t.rightInner.y,0,-1,t.distance)):t.exit0=t.entry0=this.writeVertex(t.currentVertex.x,t.currentVertex.y,t.inbound.x,t.inbound.y,t.bisector.x/t.cosine,t.bisector.y/t.cosine,0,-1,t.distance),t.cosine<e?(n=!t.isCap,t.entry2=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,-t.prevNormal.x,-t.prevNormal.y,0,1,t.distance),t.exit2=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,-t.nextNormal.x,-t.nextNormal.y,0,1,t.distance)):t.splitOuter?(n=n||t.gapOuter,t.entry2=this.writeVertex(t.currentVertex.x,t.currentVertex.y,t.inbound.x,t.inbound.y,-t.leftOuter.x,-t.leftOuter.y,0,1,t.distance),t.exit2=this.writeVertex(t.currentVertex.x,t.currentVertex.y,t.outbound.x,t.outbound.y,-t.rightOuter.x,-t.rightOuter.y,0,1,t.distance)):t.entry2=t.exit2=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,-t.bisector.x/t.cosine,-t.bisector.y/t.cosine,0,1,t.distance)):(t.splitInner?(t.exit2=this.writeVertex(t.currentVertex.x,t.currentVertex.y,t.outbound.x,t.outbound.y,-t.leftInner.x,-t.leftInner.y,0,1,t.distance),t.entry2=this.writeVertex(t.currentVertex.x,t.currentVertex.y,t.inbound.x,t.inbound.y,-t.rightInner.x,-t.rightInner.y,0,1,t.distance)):t.exit2=t.entry2=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,-t.bisector.x/t.cosine,-t.bisector.y/t.cosine,0,1,t.distance),t.cosine<e?(n=!t.isCap,t.entry0=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,t.prevNormal.x,t.prevNormal.y,0,-1,t.distance),t.exit0=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,t.nextNormal.x,t.nextNormal.y,0,-1,t.distance)):t.splitOuter?(n=n||t.gapOuter,t.entry0=this.writeVertex(t.currentVertex.x,t.currentVertex.y,t.inbound.x,t.inbound.y,t.leftOuter.x,t.leftOuter.y,0,-1,t.distance),t.exit0=this.writeVertex(t.currentVertex.x,t.currentVertex.y,t.outbound.x,t.outbound.y,t.rightOuter.x,t.rightOuter.y,0,-1,t.distance)):t.exit0=t.entry0=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,t.bisector.x/t.cosine,t.bisector.y/t.cosine,0,-1,t.distance))):t.sign>0?(t.exit0=t.entry0=this.writeVertex(t.currentVertex.x,t.currentVertex.y,t.inbound.x,t.inbound.y,t.bisector.x/t.cosine,t.bisector.y/t.cosine,0,-1,t.distance),t.cosine<e?(n=!t.isCap,t.entry2=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,-t.prevNormal.x,-t.prevNormal.y,0,1,t.distance),t.exit2=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,-t.nextNormal.x,-t.nextNormal.y,0,1,t.distance)):t.entry2=t.exit2=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,-t.bisector.x/t.cosine,-t.bisector.y/t.cosine,0,1,t.distance)):(t.exit2=t.entry2=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,-t.bisector.x/t.cosine,-t.bisector.y/t.cosine,0,1,t.distance),t.cosine<e?(n=!t.isCap,t.entry0=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,t.prevNormal.x,t.prevNormal.y,0,-1,t.distance),t.exit0=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,t.nextNormal.x,t.nextNormal.y,0,-1,t.distance)):t.exit0=t.entry0=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,t.bisector.x/t.cosine,t.bisector.y/t.cosine,0,-1,t.distance));var x,s=t.canSplit&&(t.splitInner||t.splitOuter);if(x=t.entry1=t.exit1=s||n||i?this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,0,0,0,0,t.distance):null,n&&this.joinType!==r.JoinType.ROUND)this.writeTriangle(x,t.sign>0?t.exit2:t.entry0,t.sign>0?t.entry2:t.exit0);else if(i&&this.capType===r.CapType.ROUND||n&&this.joinType===r.JoinType.ROUND){var u,l=void 0,c=void 0,y=void 0,a=void 0,d=void 0,h=void 0;if(t.isCap)h=(u=Math.PI)/(d=Math.ceil(u/this.radsPerSlice)),t.isFirstVertex?(l=t.prevNormal.x,c=t.prevNormal.y,y=t.entry0,a=t.entry2):t.isLastVertex&&(l=-t.nextNormal.x,c=-t.nextNormal.y,y=t.exit2,a=t.exit0);else h=(u=2*Math.acos(t.cosine))/(d=Math.ceil(u/this.radsPerSlice)),l=t.sign>0?-t.prevNormal.x:t.nextNormal.x,c=t.sign>0?-t.prevNormal.y:t.nextNormal.y,y=t.sign>0?t.entry2:t.exit0,a=t.sign>0?t.exit2:t.entry0;var b,p=Math.cos(h),V=Math.sin(h),g=V*l+p*c;l=p*l-V*c,c=g;for(var f=void 0,E=0;E<d;++E){if(b=f,E<d-1)if(t.isCap){var v=t.isFirstVertex?-1:1;f=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,l,c,v,0,t.distance)}else f=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,l,c,0,t.sign,t.distance);this.writeTriangle(0===E?y:b,x,E===d-1?a:f);var m=V*l+p*c;l=p*l-V*c,c=m}}else if(i&&this.capType===r.CapType.SQUARE){var N=t.isFirstVertex?1:-1,w=void 0,T=void 0;this.textured?(w=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,t.prevNormal.x-N*t.inbound.x,t.prevNormal.y-N*t.inbound.y,-N,-1,t.distance),T=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,-t.prevNormal.x-N*t.inbound.x,-t.prevNormal.y-N*t.inbound.y,-N,1,t.distance)):(w=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,t.prevNormal.x-N*t.inbound.x,t.prevNormal.y-N*t.inbound.y,0,-1,t.distance),T=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,-t.prevNormal.x-N*t.inbound.x,-t.prevNormal.y-N*t.inbound.y,0,1,t.distance)),N>0?(this.writeTriangle(x,t.entry2,T),this.writeTriangle(x,T,w),this.writeTriangle(x,w,t.entry0)):(this.writeTriangle(x,T,t.exit2),this.writeTriangle(x,w,T),this.writeTriangle(x,t.exit0,w))}},t.prototype.bridge=function(t){this.writeTriangle(t.leftExit0,t.rightEntry0,null!=t.leftExit1?t.leftExit1:t.leftExit2),this.writeTriangle(t.rightEntry0,null!=t.rightEntry1?t.rightEntry1:t.rightEntry2,null!=t.leftExit1?t.leftExit1:t.leftExit2),null!=t.leftExit1&&null!=t.rightEntry1?(this.writeTriangle(t.leftExit1,t.rightEntry1,t.leftExit2),this.writeTriangle(t.rightEntry1,t.rightEntry2,t.leftExit2)):null!=t.leftExit1?this.writeTriangle(t.leftExit1,t.rightEntry2,t.leftExit2):null!=t.rightEntry1&&this.writeTriangle(t.rightEntry1,t.rightEntry2,t.leftExit2)},t}();e.StandardTessellationCallbacks=v;var m=function(){function t(t,e){this.writeVertex=t,this.writeTriangle=e}return t.prototype.vertex=function(t){t.entry0=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,t.prevNormal.x,t.prevNormal.y,0,-1,t.distance),t.entry2=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,-t.prevNormal.x,-t.prevNormal.y,0,1,t.distance),t.exit0=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,t.nextNormal.x,t.nextNormal.y,0,-1,t.distance),t.exit2=this.writeVertex(t.currentVertex.x,t.currentVertex.y,0,0,-t.nextNormal.x,-t.nextNormal.y,0,1,t.distance)},t.prototype.bridge=function(t){this.writeTriangle(t.leftExit0,t.rightEntry0,t.leftExit2),this.writeTriangle(t.rightEntry0,t.rightEntry2,t.leftExit2)},t}();e.ThinTessellationCallbacks=m}));