// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.

define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/keys","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dijit/Destroyable","esri/dijit/geoenrichment/utils/DelayUtil","esri/dijit/geoenrichment/utils/DeviceUtil","esri/dijit/geoenrichment/utils/DomUtil","esri/dijit/geoenrichment/utils/MouseUtil","esri/dijit/geoenrichment/utils/animation/AnimationUtil","esri/dijit/geoenrichment/utils/mobile/GesturesUtil","../../../../ReportPlayerState"],(function(e,i,t,n,o,d,l,r,a,s,c,u,m,h,D,g){return e(a,{ddZoomScreen:null,currentTriggerButtonBox:null,ddZoomScreenClass:null,closeZoomedDDWhenClickedOutside:!0,closeZoomedDDOnEsc:!0,zIndex:null,dataDrillingViewDiv:null,domNode:null,constructor:function(e){i.mixin(this,e),c.isMobileDevice()&&D.preventDefaultOverflow(this.dataDrillingViewDiv)},play:function(e,i,t,n){var d=this;function a(e){e?(u.show(d.dataDrillingViewDiv),d.dataDrillingViewDiv.parentNode!==document.body&&document.body.appendChild(d.dataDrillingViewDiv),d.zIndex&&r.set(d.dataDrillingViewDiv,"zIndex",d.zIndex)):(d.dataDrillingViewDiv.parentNode===document.body&&document.body.removeChild(d.dataDrillingViewDiv),u.hide(d.dataDrillingViewDiv))}function c(){a(e),d._setZoomScreen(e,!1),d._setCloseHandlers(e),g.isViewingDataDrillingZoom=e,o[e?"add":"remove"](d.domNode,"isDrillingData"),o.remove(d.domNode,"isShowingAnimation")}if(this.currentTriggerButtonBox=t?l.position(t):this.currentTriggerButtonBox,o.add(this.domNode,"isShowingAnimation"),o.add(this.dataDrillingViewDiv,"isZoomAnimation"),i){a(!0);var m,D=this.getDataDrillingPanelDimensions(n);if(r.set(this.dataDrillingViewDiv,{width:D.w+"px",height:D.h+"px"}),this._setZoomScreen(e,!0),e){var v=D.scale||1;m=h.animateResize({duration:200,domNode:this.dataDrillingViewDiv,fromBox:D.animateFromCenter?{x:0,y:0,w:document.body.clientWidth,h:document.body.clientHeight}:this.currentTriggerButtonBox,startScaleX:.7*v,startScaleY:.7*v,fromOffset:{x:"c",y:"c"},toBox:{x:(document.body.clientWidth-D.w*v)/2,y:(document.body.clientHeight-D.h*v)/2+(D.yOffset||0),w:D.w,h:D.h},endScaleX:D.scale,endScaleY:D.scale,onEnd:c}),h.animateFadeIn({domNode:d.dataDrillingViewDiv,duration:100})}else m=h.animateResize({duration:200,domNode:this.dataDrillingViewDiv,toBox:this.currentTriggerButtonBox,startScaleX:D.scale,startScaleY:D.scale,endScaleX:.7*(D.scale||1),endScaleY:.7*(D.scale||1),toOffset:{x:"c",y:"c"},onEnd:c}),h.animateFadeOut({domNode:this.dataDrillingViewDiv,duration:100});return m&&m.then((function(){return s.delay(100)}))}c()},_setZoomScreen:function(e,i){var t=this;if(e!==!!this.ddZoomScreen)if(e)this.ddZoomScreen=d.create("div",{class:"esriGEAbsoluteStretched simpleInfographic_dataDrillingViewDivScreen"+(c.isMobileDevice()?" mobile":"")},this.dataDrillingViewDiv,"before"),c.isMobileDevice()&&D.preventDefaultOverflow(this.ddZoomScreen),this.zIndex&&r.set(this.ddZoomScreen,"zIndex",this.zIndex),this.ddZoomScreenClass&&o.add(this.ddZoomScreen,this.ddZoomScreenClass),i&&h.animateFadeIn({domNode:this.ddZoomScreen,duration:100});else{function n(){t.ddZoomScreen&&d.destroy(t.ddZoomScreen),t.ddZoomScreen=null}i?h.animateFadeOut({domNode:this.ddZoomScreen,duration:100,onEnd:n}):n()}},_clickOutsideHandler:null,_keyboardHandler:null,_setCloseHandlers:function(e){var i=this;this._clickOutsideHandler&&this._clickOutsideHandler.remove(),this._clickOutsideHandler=null,this._keyboardHandler&&this._keyboardHandler.remove(),this._keyboardHandler=null,e&&(this.closeZoomedDDWhenClickedOutside&&(this._clickOutsideHandler=t(document.body,c.press,(function(){g.isViewingDynamicSettings||m.isMouseOver(i.dataDrillingViewDiv,{checkAllChildren:!0})||i.isMouseOver()||i.onExitDataDrilling()})),this.own(this._clickOutsideHandler)),this.closeZoomedDDOnEsc&&(this._keyboardHandler=t(document.body,"keyup",(function(e){e.keyCode===n.ESCAPE&&i.onExitDataDrilling()})),this.own(this._keyboardHandler)))},isMouseOver:function(){return!1},getDataDrillingPanelDimensions:function(e){return null},onExitDataDrilling:function(){}})}));