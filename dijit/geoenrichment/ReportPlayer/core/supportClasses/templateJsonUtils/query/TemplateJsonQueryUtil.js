// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.

define(["./_SectionJsonCollector","../../../infographics/InfographicTypes"],(function(o,n){var e={},s="field",c={process:function(o,n,e,t,i){var r=t,a={processLevel:n,objJson:e,processFunc:t=function(o,n,e){o&&r.apply(this,arguments)},ignoreComparisonCalculators:i&&i.ignoreComparisonCalculators};o!==n||o===s&&n===s?"document"===o?c._processTemplateJson(e,a):"section"===o?c._processSectionJson(e,a):"table"===o?c._processTableJson(e,a,null):"tableRow"===o?c._processTableDataObj(e,a,null):o===s&&c._processFieldInfo(e,a,null):t(e)},_processTemplateJson:function(n,e){n.sectionsTables?n.sectionsTables.forEach((function(o){c._processTableJson(o,e)})):o.collectSectionJsons(n,{saveParentInfo:!1,processFieldInfoFunc:function(o){e.processLevel===s&&e.processFunc(o)}}).forEach((function(o){c._processSectionJson(o,e)}))},_processSectionJson:function(o,n){"section"===n.processLevel&&n.processFunc(o),o.stack&&o.stack.forEach((function(o){"sectionElement"===n.processLevel&&n.processFunc(o),"table"===o.id&&c._processTableJson(o,n)}))},_processTableJson:function(o,n,e){"table"===n.processLevel&&n.processFunc(o),o.data.data.forEach((function(o){"tableRow"===n.processLevel&&n.processFunc(o,e),c._processTableDataObj(o,n,e)})),o.backgroundSectionJson&&c._processSectionJson(o.backgroundSectionJson,n),o.foregroundSectionJson&&c._processSectionJson(o.foregroundSectionJson,n),o.backgroundFloatingTablesSectionJson&&c._processSectionJson(o.backgroundFloatingTablesSectionJson,n),o.foregroundFloatingTablesSectionJson&&c._processSectionJson(o.foregroundFloatingTablesSectionJson,n)},_processTableDataObj:function(o,n,e){if(o.fieldInfos)for(var s in o.fieldInfos)c._processFieldInfo(o.fieldInfos[s],n,e,"tableCell")},_processFieldInfo:function(o,n,e,t){function i(o,e){n.processLevel===s&&n.processFunc(o,e,t)}o&&(i(o,e),function(o){o&&o.triggerJson&&o.triggerJson.fieldInfo&&o.templateName!==o.triggerJson.fieldInfo.templateName&&i(o.triggerJson.fieldInfo,o)}(o),o.linkFieldInfo&&i(o.linkFieldInfo,o),o.isRichText&&(o.richTextJson.fieldInfos.forEach((function(e){c._processFieldInfo(e,n,o,"richTextPart")})),o.richTextJson.specialFieldInfos.forEach((function(e){c._processFieldInfo(e,n,o,"richTextPart")}))),o.isInfographic&&c._processInfographicFieldInfo(o,n),o.isChart&&c._processChartFieldInfo(o,n),o.isReportSection&&o.sectionJson&&c._processSectionJson(o.sectionJson,n))},_processInfographicFieldInfo:function(o,e){var s=o.infographicJson;switch(s.type){case n.STATIC:if(s.header&&c._processTableJson(s.header,e,o),s.variableTables&&s.variableTables.forEach((function(n){n.variable&&c._processFieldInfo(n.variable.fieldInfo,e,o,"staticInfographicVariable"),n.description&&n.description.fieldInfo&&c._processFieldInfo(n.description.fieldInfo,e,o,"staticInfographicDescription")})),s.dataDrilling)for(var t in s.dataDrilling){var i=s.dataDrilling[t];i&&i.sectionJson&&c._processSectionJson(i.sectionJson,e)}break;case n.AGE_PYRAMID:case n.TAPESTRY:case n.PRIZM5:case n.RELATED_VARS:case n.ONE_VAR:!e.ignoreComparisonCalculators&&s.fieldInfos&&s.fieldInfos.forEach((function(n){c._processFieldInfo(n,e,o,"dynamicInfographicVariable")}));break;case n.AREA_DETAILS:s.titleSectionJson&&c._processSectionJson(s.titleSectionJson,e,o),s.attributesSectionJson&&c._processSectionJson(s.attributesSectionJson,e,o),s.notesSectionJson&&c._processSectionJson(s.notesSectionJson,e,o);break;case n.LOCATOR_TABLE:s.titleSectionJson&&c._processSectionJson(s.titleSectionJson,e),c._processSectionJson(s.headerSectionJson,e),c._processSectionJson(s.dataSectionJson,e),s.summarySectionJson&&c._processSectionJson(s.summarySectionJson,e),s.summaryFooterSectionJson&&c._processSectionJson(s.summaryFooterSectionJson,e);break;case n.COMPARISON_TABLE:s.titleSectionJson&&c._processSectionJson(s.titleSectionJson,e),e.ignoreComparisonCalculators||c._processSectionJson(s.dataSectionJson,e)}},_processChartFieldInfo:function(o,n){var e=o.chartJson.visualProperties;e.chartIcons&&e.chartIcons.forEach((function(e){c._processFieldInfo(e,n,o,"chartIcon")})),e.floatingIcons&&e.floatingIcons.forEach((function(e){c._processTableJson(e,n,o,"floatingIcon")})),e.floatingTexts&&e.floatingTexts.forEach((function(e){c._processTableJson(e,n,o,"floatingText")})),o.chartJson.seriesItems.forEach((function(e){e.points.forEach((function(e){n.ignoreComparisonCalculators&&o.chartJson.comparisonInfo||c._processFieldInfo(e.fieldInfo,n,o,"chartPointField"),e.iconFieldInfo&&c._processFieldInfo(e.iconFieldInfo,n,o,"chartPointIcon"),e.captionFieldInfo&&c._processFieldInfo(e.captionFieldInfo,n,o,"chartPointCaption")}))}))}};return e.DOCUMENT="document",e.SECTION="section",e.TABLE="table",e.SECTION_ELEMENT="sectionElement",e.TABLE_ROW="tableRow",e.FIELD=s,e.process=c.process,e.processTemplateFieldInfos=function(o,n,e){c.process("document",s,o,n,e)},e.processSectionFieldInfos=function(o,n,e){c.process("section",s,o,n,e)},e.processSectionElements=function(o,n){c.process("document","sectionElement",o,n)},e.processTableFieldInfos=function(o,n,e){c.process("table",s,o,n,e)},e.hasMultiFeatureChart=function(o){var n=!1;return e.processTemplateFieldInfos(o,(function(o){o.isChart&&(n=n||o.chartJson&&!!o.chartJson.isMultiFeatureChart)})),n},e.hasComparisonInfographicTable=function(o){var s=!1;return e.processTemplateFieldInfos(o,(function(o){o.isInfographic&&(s=s||o.infographicJson&&o.infographicJson.type===n.COMPARISON_TABLE)})),s},e.isGraphicReport=function(o){return!!o.sectionsTables},e.hasDynamicColumns=function(o){return e._checkTableAttributes(o,(function(o){return o.dynamicColumns>0}))},e.hasDynamicRows=function(o){return e._checkTableAttributes(o,(function(o){return o.dynamicRows>0}))},e._checkTableAttributes=function(o,n){var s;return e.isGraphicReport(o)?e.processTemplateFieldInfos(o,(function(o){o.isReportSection&&o.sectionJson&&o.sectionJson.stack&&o.sectionJson.stack.some((function(o){if("table"===o.id&&o.attributes&&n(o.attributes))return s=!0,!0}))})):s=e.collectSectionJsons(o).some((function(o){return o.stack&&o.stack.some((function(o){return"table"===o.id&&o.attributes&&n(o.attributes)}))})),s},e.hasMultiFeatureSections=function(o){return!!e.isGraphicReport(o)&&(e.hasMultiFeatureChart(o)||e.hasDynamicColumns(o)||e.hasComparisonInfographicTable(o))},e.calcNumberOfMaps=function(o,n){var s=0;return e.collectSectionJsons(o).forEach((function(o){s+=e.calcNumberOfMapsInSectionJson(o,n)})),s},e.calcNumberOfMapsInSectionJson=function(o,n){var s=0;return o.stack&&o.stack.forEach((function(o){o.isMap&&(n&&n(o),s++)})),e.processSectionFieldInfos(o,(function(o){o.isMap&&(n&&n(o.mapJson),s++)})),s},e.collectSectionJsons=o.collectSectionJsons,e.getParentBox=o.getParentBox,e.setParentBox=o.setParentBox,e.getParentStyle=o.getParentStyle,e}));