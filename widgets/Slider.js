// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.15/esri/copyright.txt for details.

define(["require","exports","../core/tsSupport/assignHelper","../core/tsSupport/declareExtendsHelper","../core/tsSupport/decorateHelper","dojo/i18n!./Slider/nls/Slider","../intl","../core/deprecate","../core/events","../core/Logger","../core/maybe","../core/accessorSupport/decorators","../core/libs/pep/pep","../libs/resize-observer/ResizeObserver","./Widget","./Slider/SliderViewModel","./support/widget"],(function(t,e,i,n,o,r,s,a,l,u,h,d,p,c,_,m,v){var f="esri-slider",g="esri-slider--reversed",b="esri-slider--horizontal",y="esri-slider--vertical",x="esri-slider__content",E="esri-slider__extra-content",P="esri-slider__track",I="esri-slider__ticks",S="esri-slider__tick",k="esri-slider__tick-label",L="esri-slider__max",A="esri-slider__min",M="esri-slider__max--interactive",C="esri-slider__min--interactive",w="esri-slider__range-input",F="esri-slider__anchor",D="esri-slider__anchor--moving",V="esri-slider__anchor--moved",T="esri-slider__anchor-",O="esri-slider__segment",z="esri-slider__segment-",H="esri-slider__segment--interactive",N="esri-slider__thumb",U="esri-slider__label",B="esri-slider__label--interactive",K="esri-slider__label-input",R="esri-widget",W="esri-disabled",X="esri-hidden",Y="Enter",j="Enter",q="Escape",G="Tab",J="ArrowUp",Q="ArrowDown",Z="ArrowLeft",$="ArrowRight",tt="End",et="Home",it=u.getLogger("esri.widgets.Slider"),nt={labels:!1,rangeLabels:!1};return function(t){function e(e){var n=t.call(this,e)||this;return n._activeLabelInputIndex=null,n._anchorElements=null,n._baseNode=null,n._dragged=!1,n._dragStartInfo=null,n._focusedAnchorIndex=null,n._isMinInputActive=!1,n._isMaxInputActive=!1,n._labelElements=[],n._lastMovedHandleIndex=null,n._observer=null,n._positionPrecision=5,n._segmentDragStartInfo=null,n._segmentElements=null,n._thumbElements=[],n._tickElements=[],n._trackHeight=null,n._trackWidth=null,n._zIndices=null,n._zIndexOffset=3,n.disabled=!1,n.extraNodes=[],n.draggableSegmentsEnabled=!0,n.label=r.widgetLabel,n.labelFormatFunction=null,n.inputFormatFunction=null,n.inputParseFunction=null,n.labelInputsEnabled=!1,n.labels=null,n.max=null,n.min=null,n.precision=4,n.rangeLabelInputsEnabled=!1,n.snapOnClickEnabled=!0,n.steps=null,n.thumbsConstrained=!0,n.thumbCreatedFunction=null,n.tickConfigs=null,n.trackElement=null,n.values=null,n.viewModel=new m,n.visibleElements=i({},nt),n._observer=new c((function(){return n.scheduleRender()})),n._onAnchorPointerDown=n._onAnchorPointerDown.bind(n),n._onAnchorPointerMove=n._onAnchorPointerMove.bind(n),n._onAnchorPointerUp=n._onAnchorPointerUp.bind(n),n._onLabelPointerDown=n._onLabelPointerDown.bind(n),n._onLabelPointerUp=n._onLabelPointerUp.bind(n),n._onSegmentPointerDown=n._onSegmentPointerDown.bind(n),n._onSegmentPointerMove=n._onSegmentPointerMove.bind(n),n._onSegmentPointerUp=n._onSegmentPointerUp.bind(n),n._onTrackPointerDown=n._onTrackPointerDown.bind(n),n}return n(e,t),Object.defineProperty(e.prototype,"labelsVisible",{set:function(t){a.deprecatedProperty(it,"labelsVisible",{replacement:"visibleElements.labels",version:"4.15"}),this.visibleElements=i({},this.visibleElements,{labels:t})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layout",{set:function(t){-1===["vertical","vertical-reversed","horizontal","horizontal-reversed"].indexOf(t)&&(t="horizontal"),this._set("layout",t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rangeLabelsVisible",{set:function(t){a.deprecatedProperty(it,"rangeLabelsVisible",{replacement:"visibleElements.rangeLabels",version:"4.15"}),this.visibleElements=i({},this.visibleElements,{rangeLabels:t})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){var t=this,e=t._activeLabelInputIndex,i=t._isMaxInputActive,n=t._isMinInputActive,o=t._dragStartInfo,r=t._segmentDragStartInfo,s=t.viewModel,a=h.isSome(o)||h.isSome(r);return!(null===e&&!i&&!n)?"editing":a?"dragging":s.state},enumerable:!0,configurable:!0}),e.prototype.castVisibleElements=function(t){return i({},nt,t)},e.prototype.render=function(){var t=this.label,e=this.classes(f,R,this._isHorizontalLayout()?b:y,this._isReversedLayout()?g:null,this._isDisabled()?W:null);return this._storeTrackDimensions(),v.tsx("div",{afterCreate:this._afterBaseNodeCreate,bind:this,"aria-label":t,class:e,"touch-action":"none"},this.renderContent())},e.prototype.toNextStep=function(t){this._toStep(t,1)},e.prototype.toPreviousStep=function(t){this._toStep(t,-1)},e.prototype.renderContent=function(){return[this.renderMin(),this.renderSliderContainer(),this.renderMax()]},e.prototype.renderSliderContainer=function(){if(h.isSome(this.min)&&h.isSome(this.max))return v.tsx("div",{key:"slider-container",bind:this,class:x},this.renderTrackElement(),this.renderTicksContainer(),this.renderExtraContentElements())},e.prototype.renderTrackElement=function(){return v.tsx("div",{afterCreate:this._afterTrackCreate,bind:this,class:P,"data-node-ref":"trackElement","touch-action":"none"},this.renderSegmentElements(),this.renderAnchorElements())},e.prototype.renderSegmentElements=function(){if(this.trackElement&&this.values&&this.values.length){this._segmentElements=[];for(var t=this.values.length+1,e=[],i=0;i<t;i++)e.push(this.renderSegmentElement(i));return e}},e.prototype.renderSegmentElement=function(t){var e,i,n=this,o=n._trackHeight,r=n._trackWidth,s=n.draggableSegmentsEnabled,a=n.state,l=n.values,u=this._isHorizontalLayout(),d=u?r:o,p=t===l.length?null:t,c=0===t?null:t-1,_=h.isSome(p),m=h.isSome(c),f=l.slice().sort((function(t,e){return t-e}));this._isReversedLayout()?(e=m?this._positionFromValue(f[c]):u?d:0,i=_?this._positionFromValue(f[p]):u?0:d):(e=_?this._positionFromValue(f[p]):u?d:0,i=m?this._positionFromValue(f[c]):u?0:d);var g=this._applyPrecisionToPosition(100*i/d),b=(e-i)/d,y=u?"transform: translate("+g+"%, 0px) scale("+b+", 1);":"transform: translate(0px, "+g+"%) scale(1, "+b+");",x=this.classes(O,z+t,s&&_&&m&&"disabled"!==a?H:null);return v.tsx("div",{afterCreate:this._afterSegmentCreate,bind:this,class:x,"data-max-thumb-index":p,"data-min-thumb-index":c,"data-segment-index":t,style:y,"touch-action":"none"})},e.prototype.renderAnchorElements=function(){var t=this,e=this.trackElement,i=this.values;if(i&&i.length)return this._anchorElements=[],this._thumbElements=[],this._labelElements=[],this._zIndices=i.map((function(e,n){var o=t._positionFromValue(e),r=t._positionToPercent(o),s=(t._isHorizontalLayout()?r>50:r<50)?-1:1;return t._zIndexOffset+(i.length+s*n)})),e&&i&&i.length?i.map((function(e,i){return t.renderAnchorElement(e,i)})):null},e.prototype.renderAnchorElement=function(t,e){var i=this._positionFromValue(t),n=this._valueFromPosition(i);if(h.isSome(n)&&!isNaN(n)){var o=this,a=o._dragStartInfo,l=o._lastMovedHandleIndex,u=o.id,d=o.layout,p=o.values,c=o.visibleElements.labels,_=a&&a.index===e,m=l===e,f=this.classes(F,T+e,_?D:null,m?V:null),g=this.labels.values[e],b=this._getStyleForAnchor(t,e,_||m),y=this.viewModel.getBoundsForValueAtIndex(e),x=y.min,E=y.max,P=2===p.length?0===e?s.substitute(r.rangeMinimum,{value:t}):s.substitute(r.rangeMaximum,{value:t}):g,I=1===p.length?null:0===e?u+"-handle-"+(e+1):e===p.length-1?u+"-handle-"+(e-1):u+"-handle-"+(e-1)+" "+u+"-handle-"+(e+1);return v.tsx("div",{afterCreate:this._afterAnchorCreate,afterUpdate:this._afterAnchorUpdate,"aria-controls":I,"aria-label":r.sliderValue,"aria-labelledby":c?u+"-label-"+e:null,"aria-orientation":d,"aria-valuemax":E.toString(),"aria-valuemin":x.toString(),"aria-valuenow":t.toString(),"aria-valuetext":P,bind:this,class:f,"data-thumb-index":e,"data-value":t,id:u+"-handle-"+e,onkeydown:this._onAnchorKeyDown,"touch-action":"none",role:"slider",style:b,tabIndex:0},v.tsx("span",{afterCreate:this._afterThumbCreate,bind:this,class:N,"data-thumb-index":e,"touch-action":"none"}),this.renderThumbLabel(e))}},e.prototype.renderThumbLabel=function(t){var e=this.id,i=this.labels,n=this.labelInputsEnabled,o=this.state,r=this.visibleElements.labels,s=i.values[t],a=this.classes(U,r?null:X,n&&"disabled"!==o?B:null);return v.tsx("span",{afterCreate:this._afterLabelCreate,"aria-hidden":!r,bind:this,class:a,"data-thumb-index":t,id:e+"-label-"+t,role:n?"button":null,"touch-action":"none"},this._activeLabelInputIndex===t?this.renderValueInput(t):s)},e.prototype.renderValueInput=function(t){var e=this.values[t];return v.tsx("input",{afterCreate:this._afterInputCreate,"aria-label":r.sliderValue,bind:this,class:K,required:!0,tabIndex:0,type:"text",value:this._formatInputValue(e,"value",t),onblur:this._onLabelInputBlur,onkeydown:this._onInputKeyDown})},e.prototype.renderMax=function(){var t=this._isMaxInputActive,e=this.labels,i=this.rangeLabelInputsEnabled,n=this.state,o=this.visibleElements.rangeLabels,r=this.classes(L,o?null:X,i&&"disabled"!==n?M:null);return v.tsx("div",{"aria-hidden":!o,bind:this,class:r,onclick:this._onMaxLabelClick,onkeydown:this._onMaxLabelKeyDown,role:i?"button":null,tabIndex:i?0:null},t?this.renderMaxInput():e.max)},e.prototype.renderMin=function(){var t=this._isMinInputActive,e=this.labels,i=this.rangeLabelInputsEnabled,n=this.state,o=this.visibleElements.rangeLabels,r=this.classes(A,o?null:X,i&&"disabled"!==n?C:null);return v.tsx("div",{"aria-hidden":!o,bind:this,class:r,onclick:this._onMinLabelClick,onkeydown:this._onMinLabelKeyDown,role:i?"button":null,tabIndex:i?0:null},t?this.renderMinInput():e.min)},e.prototype.renderMaxInput=function(){return v.tsx("input",{afterCreate:this._afterInputCreate,"aria-label":r.maximumValue,bind:this,class:w,required:!0,tabIndex:0,type:"text",value:this._formatInputValue(this.max,"max"),onblur:this._onMaxInputBlur,onkeydown:this._onInputKeyDown})},e.prototype.renderMinInput=function(){return v.tsx("input",{afterCreate:this._afterInputCreate,"aria-label":r.minimumValue,bind:this,class:w,required:!0,tabIndex:0,type:"text",value:this._formatInputValue(this.min,"min"),onblur:this._onMinInputBlur,onkeydown:this._onInputKeyDown})},e.prototype.renderExtraContentElements=function(){return v.tsx("div",{bind:this,class:E},this.extraNodes)},e.prototype.renderTicksContainer=function(){var t=this;if(this.tickConfigs&&this.trackElement&&(0!==this._trackHeight||0!==this._trackWidth))return this.tickConfigs.map((function(e,i){return v.tsx("div",{key:"ticks-container",class:t.classes(I)},t.renderTicks(e,i))}))},e.prototype.renderTicks=function(t,e){var i=this,n=t.mode,o=t.values;if(this._tickElements[e]=[],"position"===n){var r=Array.isArray(o)?o:[o];return this._calculateTickPositions(r).map((function(n,o){return i.renderTickGroup(t,o,e,n)}))}if("percent"===n&&Array.isArray(o)){var s=this.max,a=this.min,l=s-a,u=o.map((function(t){return i._applyPrecisionToPosition(t/100*l+a)}));return this._calculateTickPositions(u).map((function(n,o){return i.renderTickGroup(t,o,e,n)}))}var h=Array.isArray(o)&&o.length?o[0]:isNaN(o)?null:o,d=this._getTickCounts(h,t);return this._calculateEquidistantTickPositions(d).map((function(n,o){return i.renderTickGroup(t,o,e,n)}))},e.prototype.renderTickGroup=function(t,e,i,n){var o="position"===t.mode?Array.isArray(t.values)?t.values[e]:t.values:this._valueFromPosition(n);if(h.isSome(o)&&!isNaN(o))return v.tsx("div",{afterCreate:this._afterTickGroupCreate,bind:this,"data-config":t,"data-position":n,"data-tick-config-index":i,"data-tick-group-index":e,"data-value":o,key:"tick-group-"+e},this.renderTickLine(t,e,i,o),t.labelsVisible?this.renderTickLabel(t,e,i,o):null)},e.prototype.renderTickLine=function(t,e,i,n){return v.tsx("div",{afterCreate:this._afterTickLineCreate,"aria-valuenow":n.toString(),bind:this,class:S,"data-tick-config-index":i,"data-tick-group-index":e,"data-value":n,key:"tick-label-"+e,style:this._getPositionStyleForElement(n)})},e.prototype.renderTickLabel=function(t,e,i,n){var o=t.labelFormatFunction?t.labelFormatFunction(n,"tick",e):this.viewModel.getLabelForValue(n,"tick",e);return v.tsx("div",{afterCreate:this._afterTickLabelCreate,"aria-label":o,"aria-valuenow":n.toString(),"aria-valuetext":o,bind:this,class:k,"data-tick-config-index":i,"data-tick-group-index":e,"data-value":n,key:"tick-label-"+e,style:"transform: translate(-50%); "+this._getPositionStyleForElement(n)},o)},e.prototype._afterBaseNodeCreate=function(t){this._baseNode&&this._observer.unobserve(this._baseNode),this._baseNode=t,this._observer.observe(this._baseNode)},e.prototype._afterTrackCreate=function(t){v.storeNode.call(this,t),p.applyLocal(t),t.addEventListener("pointerdown",this._onTrackPointerDown),this.scheduleRender()},e.prototype._afterSegmentCreate=function(t){this._segmentElements.push(t),p.applyLocal(t),t.addEventListener("pointerdown",this._onSegmentPointerDown)},e.prototype._afterAnchorCreate=function(t){if(this._anchorElements.push(t),p.applyLocal(t),t.addEventListener("pointerdown",this._onAnchorPointerDown),this.thumbCreatedFunction){var e=t["data-thumb-index"],i=t["data-value"],n=this._thumbElements[e]||null,o=this._labelElements[e]||null;this.thumbCreatedFunction(e,i,n,o)}},e.prototype._afterAnchorUpdate=function(t){(this._anchorElements.push(t),h.isSome(this._focusedAnchorIndex))&&(t["data-thumb-index"]===this._focusedAnchorIndex&&(t.focus(),this._focusedAnchorIndex=null))},e.prototype._afterThumbCreate=function(t){this._thumbElements.push(t)},e.prototype._afterLabelCreate=function(t){this._labelElements.push(t),p.applyLocal(t),t.addEventListener("pointerdown",this._onLabelPointerDown),t.addEventListener("pointerup",this._onLabelPointerUp)},e.prototype._afterInputCreate=function(t){t.focus(),t.select()},e.prototype._afterTickLineCreate=function(t){var e=t["data-tick-config-index"],i=t["data-tick-group-index"],n=this._tickElements[e];n[i]?n[i].line=t:n[i]={line:t,label:null}},e.prototype._afterTickLabelCreate=function(t){var e=t["data-tick-config-index"],i=t["data-tick-group-index"],n=this._tickElements[e];n[i]?n[i].label=t:n[i]={label:t,line:null}},e.prototype._afterTickGroupCreate=function(t){var e=t["data-config"];if(e&&e.tickCreatedFunction){var i=t["data-tick-config-index"],n=t["data-tick-group-index"],o=t["data-value"],r=this._tickElements[i][n];if(r){var s=r.line||null,a=r.label||null;e.tickCreatedFunction(o,s,a)}}},e.prototype._onAnchorKeyDown=function(t){if(!this._isDisabled()&&"editing"!==this.state){var e=t.target,i=l.eventKey(t),n=this._anchorElements,o=this.values,r=e["data-thumb-index"],s=n[r],a=o[r],u=this._isHorizontalLayout(),d=[J,Q,Z,$];if(i===Y&&this.labelInputsEnabled)this._activeLabelInputIndex=r,this.notifyChange("state");else if(d.indexOf(i)>-1){t.preventDefault();var p=this.steps,c=i===J||i===$?1:-1;if(h.isSome(p))this._toStep(r,this._isReversedLayout()?-1*c:c);else{var _=this._getPositionOfElement(s),m=this._isHorizontalLayout()?c:-1*c,v=_+m,f=0===this.precision?this._positionFromValue(this._valueFromPosition(v)+m):v;this._toPosition(r,f)}a!==(g=this.values[r])&&this._emitThumbChangeEvent({index:r,oldValue:a,value:g})}else if(i===tt||i===et){t.preventDefault();var g,b=this._getAnchorBoundsInPixels(r),y=b.min,x=b.max;v=u?i===tt?x:y:i===et?x:y;this._toPosition(r,v),a!==(g=this.values[r])&&this._emitThumbChangeEvent({index:r,oldValue:a,value:g})}}},e.prototype._onAnchorPointerDown=function(t){if(t.preventDefault(),!this._isDisabled()){var e=t.target,i=t.clientX,n=t.clientY,o=e["data-thumb-index"];void 0!==o&&(this._anchorElements[o]&&this._anchorElements[o].focus(),this._storeTrackDimensions(),this._dragStartInfo={clientX:i,clientY:n,index:o,position:this._getPositionOfElement(this._anchorElements[o])},this.notifyChange("state"),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}},e.prototype._onAnchorPointerMove=function(t){if(t.preventDefault(),"editing"!==this.state&&this._dragStartInfo){var e=this,i=e.values,n=e._anchorElements,o=e._dragged,r=e._dragStartInfo,s=e._dragStartInfo,a=s.index,l=s.position,u=t.clientX,h=t.clientY,d=o?"drag":"start",p=n[a],c=this._getPositionOfElement(p),_=this._applyPrecisionToPosition(this._isHorizontalLayout()?l+u-r.clientX:l+h-r.clientY);if(c!==_){var m=i[a];this._dragged=!0,this._toPosition(a,_);var v=this.values[a];o?m!==v&&this._emitThumbDragEvent({index:a,state:d,value:v}):this._emitThumbDragEvent({index:a,state:d,value:m})}}},e.prototype._onAnchorPointerUp=function(t){if(t.preventDefault(),document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),this._dragStartInfo){var e=this._dragStartInfo.index,i=this._dragged;this._dragged=!1,this._dragStartInfo=null,this._lastMovedHandleIndex=e,i?(this.notifyChange("state"),this._emitThumbDragEvent({index:e,state:"stop",value:this.values[e]})):this.scheduleRender()}},e.prototype._onTrackPointerDown=function(t){var e=this._dragStartInfo,i=this.snapOnClickEnabled,n=this.state,o=this.values;if(!this._isDisabled()&&"editing"!==n&&!e&&i&&o.length){var r=this.steps,s=t.clientX,a=t.clientY,l=this._getCursorPositionFromEvent(t),u=this._valueFromPosition(l),d=this._getIndexOfNearestValue(u);if(h.isSome(d)){var p=o[d],c=h.isSome(r)?this._calculateNearestStepPosition(l):l;this._toPosition(d,c),this._dragged=!0,this._dragStartInfo={clientX:s,clientY:a,index:d,position:c},this._focusedAnchorIndex=d,this.notifyChange("state"),this._emitThumbDragEvent({index:d,state:"start",value:p});var _=this.values[d];p!==_&&this._emitThumbDragEvent({index:d,state:"drag",value:_}),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove)}}},e.prototype._onSegmentPointerDown=function(t){t.preventDefault();var e=this.draggableSegmentsEnabled,i=t.target,n=i["data-segment-index"],o=i["data-min-thumb-index"],r=i["data-max-thumb-index"];!this._isDisabled()&&e&&h.isSome(o)&&h.isSome(r)&&(t.stopPropagation(),this._storeTrackDimensions(),this._segmentDragStartInfo={cursorPosition:this._getCursorPositionFromEvent(t),index:n,details:this._normalizeSegmentDetails({min:this._getAnchorDetails(o),max:this._getAnchorDetails(r)})},this.notifyChange("state"),this._emitSegmentDragEvent({index:n,state:"start",thumbIndices:[o,r]}),document.addEventListener("pointerup",this._onSegmentPointerUp),document.addEventListener("pointermove",this._onSegmentPointerMove))},e.prototype._onSegmentPointerMove=function(t){if(this._segmentDragStartInfo){t.preventDefault();var e=this._trackHeight,i=this._trackWidth,n=this._segmentDragStartInfo,o=n.index,r=n.cursorPosition,s=n.details,a=s.min,l=s.max,u=a.index,h=a.position,d=a.value,p=l.index,c=l.position,_=l.value;this._dragged=!0;var m=this._getCursorPositionFromEvent(t);if(m!==r){var v=this._positionToPercent(r),f=this._positionToPercent(m)-v,g=this._positionToPercent(h)+f,b=this._positionToPercent(c)+f,y=this._getAnchorBoundsAsPercents(u).min,x=this._getAnchorBoundsAsPercents(p).max,E=!1,P=!1;if(g<y?E=!0:b>x&&(P=!0),E){var I=this.viewModel.getBoundsForValueAtIndex(u),S=I.min,k=I.max,L=M=this._isPositionInverted()?k:S,A=_+(M-d);this._updateAnchorValues([u,p],[L,A])}else if(P){var M,C=this.viewModel.getBoundsForValueAtIndex(p);S=C.min,k=C.max,A=M=this._isPositionInverted()?S:k,L=d+(M-_);this._updateAnchorValues([u,p],[L,A])}else{var w=this._isHorizontalLayout()?i:e,F=b/100*w,D=g/100*w,V=this.values,T=[V[u],V[p]],O=this._getValueForAnchorAtPosition(u,D),z=this._getValueForAnchorAtPosition(p,F);this._updateAnchorValues([u,p],[O,z]),[this.values[u],this.values[p]].every((function(t,e){return t===T[e]}))||this._emitSegmentDragEvent({index:o,state:"drag",thumbIndices:[u,p]})}}}},e.prototype._onSegmentPointerUp=function(t){if(t.preventDefault(),document.removeEventListener("pointerup",this._onSegmentPointerUp),document.removeEventListener("pointermove",this._onSegmentPointerMove),this._segmentDragStartInfo){var e=this.max,i=this.min,n=this.values,o=this._segmentDragStartInfo,r=o.index,s=o.details,a=s.min.index,l=s.max.index,u=e-i,h=n[a],d=n[l];this._lastMovedHandleIndex=h===d?h>u/2?a:l:null,this._dragged=!1,this._segmentDragStartInfo=null,this.notifyChange("state"),this._emitSegmentDragEvent({index:r,state:"stop",thumbIndices:[a,l]})}},e.prototype._storeTrackDimensions=function(){if(this.trackElement){var t=this._getDimensions(this.trackElement);this._trackHeight=t.height,this._trackWidth=t.width}},e.prototype._onLabelPointerDown=function(){this._isDisabled()||(this._dragged=!1,document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))},e.prototype._onLabelPointerMove=function(){this._isDisabled()||(this._dragged=!0)},e.prototype._onLabelPointerUp=function(t){if(!this._isDisabled()){var e=t.target["data-thumb-index"];this.labelInputsEnabled&&!this._dragged&&h.isSome(e)&&(this._activeLabelInputIndex=e),this._dragged=!1,this.notifyChange("state"),document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove)}},e.prototype._onLabelInputBlur=function(t){var e=this._activeLabelInputIndex,i=this.values,n=this.viewModel,o=t.target.value;if(this._activeLabelInputIndex=null,this.notifyChange("state"),o){var r=this._parseInputValue(o,"value",e),s=i[e];n.setValue(e,r);var a=this.values[e];s!==a&&this._emitThumbChangeEvent({index:e,oldValue:s,value:a})}},e.prototype._onInputKeyDown=function(t){if(!this._isDisabled()){var e=t.target,i=l.eventKey(t),n=j,o=q,r=G,s=this._activeLabelInputIndex,a=this._anchorElements,u=e;if(i===n||i===o||i===r){t.stopPropagation();var d=s;u.blur(),h.isSome(d)?a[d].focus():u.parentElement.focus()}}},e.prototype._onMaxLabelClick=function(){!this._isDisabled()&&this.rangeLabelInputsEnabled&&(this._isMaxInputActive=!0,this.notifyChange("state"))},e.prototype._onMaxLabelKeyDown=function(t){this._isDisabled()||l.eventKey(t)!==Y||(this._isMaxInputActive=!0,this.notifyChange("state"))},e.prototype._onMaxInputBlur=function(t){var e=t.target.value;if(this._isMaxInputActive=!1,this.notifyChange("state"),e){var i=this.max;this.viewModel.set("max",this._parseInputValue(e,"max")),this.max!==i&&this._emitMaxChangeEvent({oldValue:i,value:this.max})}},e.prototype._onMinLabelClick=function(){!this._isDisabled()&&this.rangeLabelInputsEnabled&&(this._isMinInputActive=!0,this.notifyChange("state"))},e.prototype._onMinLabelKeyDown=function(t){this._isDisabled()||l.eventKey(t)!==Y||(this._isMinInputActive=!0,this.notifyChange("state"))},e.prototype._onMinInputBlur=function(){var t=event.target.value;if(this._isMinInputActive=!1,this.notifyChange("state"),t){var e=this.min;this.viewModel.set("min",this._parseInputValue(t,"min")),this.min!==e&&this._emitMinChangeEvent({oldValue:e,value:this.min})}},e.prototype._isDisabled=function(){return this.disabled||"disabled"===this.state},e.prototype._positionFromValue=function(t){var e=this.max,i=this.min,n=e-i;if(0===n)return 0;var o=this._trackHeight,r=this._trackWidth,s=this._isHorizontalLayout(),a=s?parseFloat((r*(t-i)/n).toFixed(2)):parseFloat((o*(e-t)/n).toFixed(2));return this._isReversedLayout()&&(a=s?r-a:o-a),a},e.prototype._valueFromPosition=function(t){var e=this,i=e._trackHeight,n=e._trackWidth,o=e.max,r=e.min,s=e.precision,a=o-r,l=this._isHorizontalLayout()?t*a/n+r:a*(1e3-t/i*1e3)/1e3+r;return this._isReversedLayout()&&(l=o+r-l),parseFloat(l.toFixed(s))},e.prototype._positionToPercent=function(t){var e=this._trackHeight,i=this._trackWidth,n=100*t/(this._isHorizontalLayout()?i:e);return this._applyPrecisionToPosition(n)},e.prototype._applyPrecisionToPosition=function(t){return parseFloat(t.toFixed(this._positionPrecision))},e.prototype._isPositionInverted=function(){var t=this.layout;return"horizontal-reversed"===t||"vertical"===t},e.prototype._isHorizontalLayout=function(){return this.layout.indexOf("horizontal")>-1},e.prototype._isReversedLayout=function(){return this.layout.indexOf("reversed")>-1},e.prototype._normalizeSegmentDetails=function(t){if(this._isPositionInverted()){var e=t.min;return{min:t.max,max:e}}return t},e.prototype._parseInputValue=function(t,e,i){return this.inputParseFunction?this.inputParseFunction(t,e,i):this.viewModel.defaultInputParseFunction(t)},e.prototype._formatInputValue=function(t,e,i){return this.inputFormatFunction?this.inputFormatFunction(t,e,i):this.viewModel.defaultInputFormatFunction(t)},e.prototype._getAnchorDetails=function(t){return{index:t,position:this._getPositionOfElement(this._anchorElements[t]),value:this.values[t]}},e.prototype._updateAnchorStyle=function(t,e){var i=this._anchorElements[t];i&&(this._isHorizontalLayout()?i.style.left=""+e:i.style.top=""+e)},e.prototype._getStyleForAnchor=function(t,e,i){var n=this._zIndices[e],o=i?this._zIndexOffset+n:n;return this._getPositionStyleForElement(t)+"; z-index: "+o},e.prototype._getPositionStyleForElement=function(t){var e=this._positionFromValue(t),i=this._positionToPercent(e);return(this._isHorizontalLayout()?"left":"top")+": "+i+"%"},e.prototype._getPositionOfElement=function(t){var e=this._getDimensions(t.offsetParent),i=this._getDimensions(t);return this._isHorizontalLayout()?this._applyPrecisionToPosition(i.left-e.left):this._applyPrecisionToPosition(i.top-e.top)},e.prototype._updateAnchorValues=function(t,e){var i=this;t.forEach((function(t,n){return i._toValue(t,e[n])}))},e.prototype._toValue=function(t,e){h.isSome(this.steps)&&(e=this._getStepValues()[this._getIndexOfNearestStepValue(e)]);this._updateAnchorStyle(t,this._getPositionStyleForElement(e)),this.viewModel.setValue(t,e)},e.prototype._toPosition=function(t,e){var i=h.isSome(this.steps)?this._getStepValueForAnchorAtPosition(t,e):this._getValueForAnchorAtPosition(t,e);this._updateAnchorStyle(t,this._getPositionStyleForElement(i)),this.viewModel.setValue(t,i)},e.prototype._getValueForAnchorAtPosition=function(t,e){var i,n,o=this._getAnchorBoundsInPixels(t),r=o.min,s=o.max,a=this.viewModel.getBoundsForValueAtIndex(t),l=a.min,u=a.max,h=null;return this._isPositionInverted()?(i=l,n=u):(i=u,n=l),(h=e>s?i:e<r?n:this._valueFromPosition(e))>u?h=u:h<l&&(h=l),h},e.prototype._getStepValueForAnchorAtPosition=function(t,e){var i=this._getStepValues(),n=this._calculateNearestStepPosition(e),o=this._getValueForAnchorAtPosition(t,n);return i[this._getIndexOfNearestStepValue(o)]},e.prototype._getAnchorBoundsAsPercents=function(t){var e=this._getAnchorBoundsInPixels(t),i=e.min,n=e.max;return{min:this._positionToPercent(i),max:this._positionToPercent(n)}},e.prototype._getAnchorBoundsInPixels=function(t){var e=this._anchorElements,i=this._trackHeight,n=this._trackWidth,o=this.thumbsConstrained,r=e[t-1],s=e[t+1],a=this._isHorizontalLayout()?n:i;return o?this._isPositionInverted()?{max:r?this._getPositionOfElement(r):a,min:s?this._getPositionOfElement(s):0}:{max:s?this._getPositionOfElement(s):a,min:r?this._getPositionOfElement(r):0}:{max:a,min:0}},e.prototype._getIndexOfNearestValue=function(t){return this.values.indexOf(this.values.reduce((function(e,i){return Math.abs(i-t)<Math.abs(e-t)?i:e})))},e.prototype._getCursorPositionFromEvent=function(t){var e=this._getDimensions(this.trackElement);return this._isHorizontalLayout()?t.clientX-e.left:t.clientY-e.top},e.prototype._getStepValues=function(){var t=this.steps;if(Array.isArray(t))return t;for(var e=this.max,i=this.min,n=Math.ceil((e-i)/t),o=[],r=0;r<=n;r++){var s=i+t*r;o.push(s>e?e:s)}return o},e.prototype._toStep=function(t,e){var i=this.values,n=this.viewModel,o=i[t],r=this._getStepValues(),s=r.indexOf(o),a=null;if(s>-1){var l=r[s+e],u=this._positionFromValue(l);a=this._getStepValueForAnchorAtPosition(t,u)}else{a=r[this._getIndexOfNearestStepValue(o)+e]}n.setValue(t,a)},e.prototype._getIndexOfNearestStepValue=function(t){var e=this.steps;if(!h.isSome(e))return null;var i=this._getStepValues(),n=i.reduce((function(e,i){return Math.abs(i-t)<Math.abs(e-t)?i:e}));return i.indexOf(n)},e.prototype._calculateNearestStepPosition=function(t){var e=this._valueFromPosition(t),i=this._getIndexOfNearestStepValue(e),n=this._getStepValues();return this._positionFromValue(n[i])},e.prototype._getTickCounts=function(t,e){var i=e.mode;return"count"===i||"position"===i?t||0:"percent"===i&&100/t||0},e.prototype._calculateTickPositions=function(t){var e=this;return t.map((function(t){return e._positionFromValue(t)}))},e.prototype._calculateEquidistantTickPositions=function(t){var e=this._trackWidth,i=this._trackHeight,n=this._isHorizontalLayout()?e:i,o=n/(t-1),r=[];if(1===t)return[n/2];for(var s=0;s<t;s++){var a=s*o;a<=n&&r.push(a)}return r},e.prototype._getDimensions=function(t){try{return t.getBoundingClientRect()}catch(t){if("object"==typeof t&&null!==t)return{top:0,bottom:0,left:0,width:0,height:0,right:0};throw t}},e.prototype._emitMaxChangeEvent=function(t){this.emit("max-change",i({},t,{type:"max-change"}))},e.prototype._emitMinChangeEvent=function(t){this.emit("min-change",i({},t,{type:"min-change"}))},e.prototype._emitThumbChangeEvent=function(t){this.emit("thumb-change",i({},t,{type:"thumb-change"}))},e.prototype._emitThumbDragEvent=function(t){this.emit("thumb-drag",i({},t,{type:"thumb-drag"}))},e.prototype._emitSegmentDragEvent=function(t){this.emit("segment-drag",i({},t,{type:"segment-drag"}))},o([d.property(),v.renderable()],e.prototype,"disabled",void 0),o([d.property()],e.prototype,"extraNodes",void 0),o([d.property(),v.renderable()],e.prototype,"draggableSegmentsEnabled",void 0),o([d.property()],e.prototype,"label",void 0),o([d.aliasOf("viewModel.labelFormatFunction")],e.prototype,"labelFormatFunction",void 0),o([d.aliasOf("viewModel.inputFormatFunction")],e.prototype,"inputFormatFunction",void 0),o([d.aliasOf("viewModel.inputParseFunction")],e.prototype,"inputParseFunction",void 0),o([d.property()],e.prototype,"labelInputsEnabled",void 0),o([d.aliasOf("viewModel.labels")],e.prototype,"labels",void 0),o([d.property(),v.renderable()],e.prototype,"labelsVisible",null),o([d.property({value:"horizontal"}),v.renderable()],e.prototype,"layout",null),o([d.aliasOf("viewModel.max")],e.prototype,"max",void 0),o([d.aliasOf("viewModel.min")],e.prototype,"min",void 0),o([d.aliasOf("viewModel.precision")],e.prototype,"precision",void 0),o([d.property()],e.prototype,"rangeLabelInputsEnabled",void 0),o([d.property(),v.renderable()],e.prototype,"rangeLabelsVisible",null),o([d.property()],e.prototype,"snapOnClickEnabled",void 0),o([d.property({dependsOn:["viewModel.state"],readOnly:!0}),v.renderable()],e.prototype,"state",null),o([d.property(),v.renderable()],e.prototype,"steps",void 0),o([d.aliasOf("viewModel.thumbsConstrained")],e.prototype,"thumbsConstrained",void 0),o([d.property()],e.prototype,"thumbCreatedFunction",void 0),o([d.property(),v.renderable()],e.prototype,"tickConfigs",void 0),o([d.property()],e.prototype,"trackElement",void 0),o([d.aliasOf("viewModel.values")],e.prototype,"values",void 0),o([d.property(),v.renderable(["viewModel.thumbsConstrained","viewModel.max","viewModel.min","viewModel.precision","viewModel.labelFormatFunction","viewModel.labels","viewModel.values"])],e.prototype,"viewModel",void 0),o([d.property(),v.renderable()],e.prototype,"visibleElements",void 0),o([d.cast("visibleElements")],e.prototype,"castVisibleElements",null),e=o([d.subclass("esri.widgets.Slider")],e)}(d.declared(_))}));