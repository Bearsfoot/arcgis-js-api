// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.15/esri/copyright.txt for details.

define(["require","exports","../../core/tsSupport/declareExtendsHelper","../../core/tsSupport/decorateHelper","../../core/Accessor","../../core/Error","../../core/Logger","../../core/maybe","../../core/accessorSupport/decorators"],(function(e,t,r,i,o,n,s,a,l){var u=s.getLogger("esri.widgets.Slider.SliderViewModel");return function(e){function t(t){var r=e.call(this,t)||this;return r.precision=4,r.thumbsConstrained=!0,r}return r(t,e),Object.defineProperty(t.prototype,"labelFormatFunction",{set:function(e){this._set("labelFormatFunction",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputFormatFunction",{set:function(e){this._set("inputFormatFunction",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputParseFunction",{set:function(e){this._set("inputParseFunction",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labels",{get:function(){var e=this,t=this.max,r=this.min,i=this.values,o=i&&i.length?i.map((function(t,r){return e.getLabelForValue(t,"value",r)})):[];return{max:this.getLabelForValue(t,"max"),min:this.getLabelForValue(r,"min"),values:o}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"max",{set:function(e){this.setMax(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"min",{set:function(e){this.setMin(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){var e=this.max,t=this.min;return a.isSome(e)&&a.isSome(t)?"ready":"disabled"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"values",{set:function(e){var t=this.max,r=this.min,i=this.values;i&&e&&i.length===e.length&&i.every((function(t,r){return t===e[r]}))||(this._set("values",null),e&&e.length&&(a.isSome(r)&&e.some((function(e){return e<r}))&&(this.min=Math.min.apply(Math,e)),a.isSome(t)&&e.some((function(e){return e>t}))&&(this.max=Math.max.apply(Math,e))),this._set("values",e))},enumerable:!0,configurable:!0}),t.prototype.toPrecision=function(e){return parseFloat(e.toFixed(this.precision))},t.prototype.defaultLabelFormatFunction=function(e){var t=this.max,r=this.min,i=this.precision,o=t-r>10?2:i;return parseFloat(e.toFixed(o)).toString()},t.prototype.defaultInputFormatFunction=function(e){return e.toString()},t.prototype.defaultInputParseFunction=function(e){return parseFloat(e)},t.prototype.getBoundsForValueAtIndex=function(e){var t=this.thumbsConstrained,r=this.max,i=this.min,o=this.values;if(t){var n=e-1,s=e+1;return{min:a.isSome(o[n])?o[n]:i,max:a.isSome(o[s])?o[s]:r}}return{min:i,max:r}},t.prototype.getLabelForValue=function(e,t,r){return a.isSome(e)?this.labelFormatFunction?this.labelFormatFunction(e,t,r):this.defaultLabelFormatFunction(e):null},t.prototype.setMax=function(e){var t=this.max,r=this.min,i=this.values;if(isNaN(e))this._logError("slider:invalid-value","Property 'max' must of type 'number'.");else if(null!==e){var o=this.toPrecision(e);if(t!==o)if(a.isSome(r)&&o<=r)this._logError("slider:invalid-value","Property 'max' must be greater than 'min'.");else if(this._set("max",o),i&&i.length)for(var n=0;n<i.length;n++)o<i[n]&&this.setValue(n,o)}else this._set("max",null)},t.prototype.setMin=function(e){var t=this.max,r=this.min,i=this.values;if(isNaN(e))this._logError("slider:invalid-value","Property 'min' must of type 'number'.");else if(null!==e){var o=this.toPrecision(e);if(r!==o)if(a.isSome(t)&&o>=t)this._logError("slider:invalid-value","Property 'min' must be less than 'max'.");else if(this._set("min",o),i&&i.length)for(var n=0;n<i.length;n++)o>i[n]&&this.setValue(n,o)}else this._set("min",null)},t.prototype.setValue=function(e,t){var r=this.values,i=r[e],o=this.toPrecision(t);if(i!==o){var n=this.getBoundsForValueAtIndex(e),s=n.min,a=n.max;if(o<s||o>a)this._logError("slider:invalid-value","Members of property 'values' must be within range.");else{var l=r.slice();l[e]=o,this._set("values",l),this.notifyChange("labels")}}},t.prototype._logError=function(e,t,r){u.error(new n(e,t,r))},i([l.property()],t.prototype,"labelFormatFunction",null),i([l.property()],t.prototype,"inputFormatFunction",null),i([l.property()],t.prototype,"inputParseFunction",null),i([l.property({dependsOn:["labelFormatFunction","max","min","values"],readOnly:!0})],t.prototype,"labels",null),i([l.property()],t.prototype,"max",null),i([l.property()],t.prototype,"min",null),i([l.property()],t.prototype,"precision",void 0),i([l.property({dependsOn:["max","min"],readOnly:!0})],t.prototype,"state",null),i([l.property()],t.prototype,"thumbsConstrained",void 0),i([l.property()],t.prototype,"values",null),t=i([l.subclass("esri.widgets.Slider.SliderViewModel")],t)}(l.declared(o))}));