// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.15/esri/copyright.txt for details.

define(["require","exports","../../../core/tsSupport/declareExtendsHelper","../../../core/tsSupport/decorateHelper","dojo/i18n!../../Legend/nls/Legend","../../../intl","../../../core/accessorSupport/decorators","../../Widget","./support/utils","../support/styleUtils","../../support/widget"],(function(e,r,t,s,l,i,n,a,o,d,p){var c="esri-widget",y="esri-legend esri-widget--panel",g="esri-legend__service",u="esri-legend__service-label",_="esri-legend__layer",h="esri-legend__group-layer",v="esri-legend__group-layer-child",m="esri-legend__layer-table",f="esri-legend__layer-table--size-ramp",b="esri-legend__layer-child-table",x="esri-legend__layer-caption",L="esri-legend__layer-body",w="esri-legend__layer-row",F="esri-legend__layer-cell esri-legend__layer-cell--info",S="esri-legend__imagery-layer-image--stretched",I="esri-legend__imagery-layer-info--stretched",E="esri-legend__layer-cell esri-legend__layer-cell--symbols",T="esri-legend__symbol",R="esri-legend__ramps",N="esri-legend__size-ramp",z="esri-legend__color-ramp",C="esri-legend__opacity-ramp",k="esri-legend__ramp-labels",A="esri-legend__ramp-label",H="esri-legend__message",j="esri-widget__heading";return function(e){function r(r){var t=e.call(this,r)||this;return t.activeLayerInfos=null,t.type="classic",t}return t(r,e),r.prototype.render=function(){var e=this,r=this.activeLayerInfos,t=this.classes(y,c),s=r&&r.toArray().map((function(r){return e._renderLegendForLayer(r)})).filter((function(e){return!!e}));return p.tsx("div",{class:t},s&&s.length?s:p.tsx("div",{class:H},l.noLegend))},r.prototype._renderLegendForLayer=function(e){var r,t=this;if(!e.ready)return null;var s=!!e.children.length,l="esri-legend__"+e.layer.uid+"-version-"+e.version,i=e.title?p.tsx("h3",{class:this.classes(j,u)},e.title):null;if(s){var n=e.children.map((function(e){return t._renderLegendForLayer(e)})).toArray();return p.tsx("div",{key:l,class:this.classes(g,h)},i,n)}var a=e.legendElements;if(a&&!a.length)return null;var o=a.map((function(r){return t._renderLegendForElement(r,e.layer)})).filter((function(e){return!!e}));if(!o.length)return null;var d=((r={})[v]=!!e.parent,r);return p.tsx("div",{key:l,class:this.classes(g,d)},i,p.tsx("div",{class:_},o))},r.prototype._renderLegendForElement=function(e,r,t){var s,l=this,i="color-ramp"===e.type,n="opacity-ramp"===e.type,a="size-ramp"===e.type,c=null;if("symbol-table"===e.type||a){var y=e.infos.map((function(t){return l._renderLegendForElementInfo(t,r,a,e.legendType)})).filter((function(e){return!!e}));y.length&&(c=p.tsx("div",{class:L},y))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?c=this._renderLegendForRamp(e,r.opacity):"relationship-ramp"===e.type&&(c=o.renderRelationshipRamp(e,this.id,r.opacity));if(!c)return null;var g=e.title,u=null;if("string"==typeof g)u=g;else if(g){var _=d.getTitle(g,i||n);u=d.isRendererTitle(g,i||n)&&g.title?g.title+" ("+_+")":_}var h=t?b:m,v=u?p.tsx("div",{class:x},u):null,w=((s={})[f]=a||!t,s);return p.tsx("div",{class:this.classes(h,w)},v,c)},r.prototype._renderLegendForRamp=function(e,r){var t=this,s=e.infos,i="opacity-ramp"===e.type,n="heatmap-ramp"===e.type,a="stretch-ramp"===e.type,o=e.preview,c=i?C:"";o.className=z+" "+c,null!=r&&(o.style.opacity=r.toString());var y=s.map((function(e){return p.tsx("div",{class:e.label?A:null},n?l[e.label]:a?t._getStretchStopLabel(e):e.label)})),g={width:"24px"},u={height:o.style.height};return p.tsx("div",{class:w},p.tsx("div",{class:E,styles:g},p.tsx("div",{class:R,bind:o,afterCreate:d.attachToNode})),p.tsx("div",{class:F},p.tsx("div",{class:k,styles:u},y)))},r.prototype._getStretchStopLabel=function(e){return e.label?l[e.label]+": "+i.formatNumber(e.value,{style:"decimal"}):""},r.prototype._renderLegendForElementInfo=function(e,r,t,s){var l,i;if(e.type)return this._renderLegendForElement(e,r,!0);var n=null,a=d.isImageryStretchedLegend(r,s);if(e.symbol&&e.preview?n=p.tsx("div",{class:T,bind:e.preview,afterCreate:d.attachToNode}):e.src&&(n=this._renderImage(e,r,a)),!n)return null;var o=((l={})[I]=a,l),c=((i={})[I]=a,i[N]=!a&&t,i);return p.tsx("div",{class:w},p.tsx("div",{class:this.classes(E,c)},n),p.tsx("div",{class:this.classes(F,o)},d.getTitle(e.label,!1)||""))},r.prototype._renderImage=function(e,r,t){var s,l=e.label,i=e.src,n=e.opacity,a=((s={})[S]=t,s[T]=!t,s),o={opacity:""+(null!=n?n:r.opacity)};return p.tsx("img",{alt:d.getTitle(l,!1),src:i,border:0,width:e.width,height:e.height,class:this.classes(a),styles:o})},s([p.renderable(),n.property()],r.prototype,"activeLayerInfos",void 0),s([n.property({readOnly:!0})],r.prototype,"type",void 0),r=s([n.subclass("esri.widgets.Legend.styles.Classic")],r)}(n.declared(a))}));