// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.15/esri/copyright.txt for details.

define(["require","exports","../core/tsSupport/declareExtendsHelper","../core/tsSupport/decorateHelper","../core/tsSupport/assignHelper","dojo/i18n!../nls/common","dojo/i18n!./Directions/nls/Directions","../intl","../moment","../core/Collection","../core/events","../core/Handles","../core/watchUtils","../core/accessorSupport/decorators","../libs/sortablejs/Sortable","./Search","./Widget","./Directions/DirectionsViewModel","./Directions/support/CostSummary","./Directions/support/directionsUtils","./Directions/support/maneuverUtils","./Directions/support/RouteSections","./support/DatePicker","./support/TimePicker","./support/widget"],(function(e,t,r,s,i,o,n,a,l,c,d,u,p,h,_,v,m,g,f,y,S,w,M,b,x){var T="now",k="esri-directions esri-widget esri-widget--panel",C="esri-directions__clear-route-button",R="esri-directions__scroller",D="esri-directions__panel-content",I="esri-directions__panel-content--loading",P="esri-directions__panel-content--error",z="esri-directions__panel-content--sign-in",H="esri-directions__loader",O="esri-directions__message",A="esri-directions__travel-modes-select",L="esri-directions__departure-time",E="esri-directions__departure-time-select",U="esri-directions__directions-section",F="esri-directions__departure-time-controls",N="esri-directions__section",V="esri-directions__summary",B="esri-directions__stop-icon",q="esri-directions__stop-icon--interactive",j="esri-directions__remove-stop",W="esri-directions__remove-stop-icon",G="esri-directions__reverse-stops",J="esri-directions__stop-icon-container",K="esri-directions__stop-icon-container--last",Q="esri-directions__stop-handle",X="esri-directions__stop-input",Y="esri-directions__stop-options",Z="esri-directions__stop-underline",$="esri-directions__stop-handle-icon",ee="esri-directions__vertical-splitter",te="esri-directions__stop-row",re="esri-directions__stop-row-ghost",se="esri-directions__stop-row--valid",ie="esri-directions__stops",oe="esri-directions__add-stop",ne="esri-directions__add-stop-text",ae="esri-directions__costs",le="esri-directions__costs-details",ce="esri-directions__costs-value",de="esri-directions__other-costs-total",ue="esri-directions__route-actions",pe="esri-directions__maneuvers",he="esri-directions__maneuver-list",_e="esri-directions__maneuver-section",ve="esri-directions__maneuver-section-header",me="esri-directions__maneuver-section-header-toggle-button",ge="esri-directions__maneuver-section-title",fe="esri-directions__maneuver-section--collapsible",ye="esri-directions__maneuver-section-toggle",Se="esri-directions__maneuver",we="esri-directions__maneuver--active",Me="esri-directions__maneuver-costs",be="esri-directions__maneuver-costs-container",xe="esri-directions__maneuver-icon",Te="esri-directions__cost--cumulative",ke="esri-directions__cost--intermediate",Ce="esri-directions__horizontal-splitter",Re="esri-directions__section-splitter",De="esri-directions__disclaimer",Ie="esri-directions__sign-in-content",Pe="esri-directions__sign-in-button",ze="esri-directions__content-title",He="esri-directions__warning-card",Oe="esri-directions__warning-header",Ae="esri-directions__warning-heading",Le="esri-directions__warning-message",Ee="esri-icon-radio-unchecked",Ue="esri-icon-radio-checked",Fe="esri-icon-handle-vertical",Ne="esri-icon-plus",Ve="esri-icon-close",Be="esri-icon-up-down-arrows",qe="esri-icon-right-triangle-arrow",je="esri-icon-down-arrow",We="esri-icon-notice-triangle",Ge="esri-icon-directions",Je="esri-widget__anchor",Ke="esri-button",Qe="esri-button--secondary",Xe="esri-button--tertiary",Ye="esri-widget__content--empty",Ze="esri-widget__content-illustration--empty",$e="esri-widget__heading",et="esri-select",tt="esri-icon-font-fallback-text",rt="awaiting-view-click-stop",st=e.toUrl("../themes/base/images/maneuvers/");var it={hour:"numeric",minute:"numeric"},ot={minimumIntegerDigits:2};return function(e){function t(t){var r=e.call(this,t)||this;return r._autoStopRemovalDelay=100,r._costSummary=new f,r._departureTime=T,r._datePicker=new M,r._handles=new u,r._newPlaceholderStop=null,r._routeSections=new w,r._stops=new c([{},{}]),r._stopsToSearches=new Map,r._timePicker=new b,r.goToOverride=null,r.iconClass=Ge,r.label=n.widgetLabel,r.lastRoute=null,r.maxStops=null,r.routeServiceUrl=null,r.routeSymbol=null,r.searchProperties=null,r.stopSymbols=null,r.view=null,r.viewModel=new g,r._setUpDragAndDropStops=function(e){r._sortable=_.create(e,{draggable:"."+se,ghostClass:re,handle:"."+Q,onEnd:r._handleStopInputDragEnd})},r._handleStopInputDragEnd=function(e){var t=e.oldIndex,s=e.newIndex,i=e.target;if(t!==s){var o=i.children,n=o[s],a=o[t],l=s-t<0;i.insertBefore(n,l?a.nextElementSibling:a);var c=r._stops;c.reorder(c.getItemAt(t),s),r._processStops()}},r}return r(t,e),t.prototype.postInitialize=function(){var e=this;this.own([p.init(this,"viewModel.lastRoute",(function(){e._routeSections.routePath=e.get("viewModel.directionLines"),e._activeManeuver=null,e._focusedManeuver=null,e.scheduleRender()})),p.init(this,"viewModel.selectedTravelMode, viewModel.departureTime",(function(){e.get("viewModel.stops.length")>1&&e.getDirections()})),p.when(this,"view",(function(t,r){if(r&&(e._viewClickHandle=null,e._handles.remove(r)),t){var s=e._prepViewClick();e._handles.add([d.on(t.surface,"mousedown",(function(){return e._autoStopRemovalDelay=500})),d.on(t.surface,"mouseup",(function(){return e._autoStopRemovalDelay=100})),s],e.view.surface),e._viewClickHandle=s}})),p.whenOnce(this,"routeServiceUrl",(function(){return e.viewModel.load()})),p.watch(this,"viewModel.stops.length",(function(t){0===t&&(e._stops.toArray().forEach((function(t){return e._removeStop(t,!0)})),e._stops.addMany([{},{}]),e.scheduleRender())}))])},t.prototype.destroy=function(){this._datePicker.destroy(),this._timePicker.destroy(),this._stopsToSearches.forEach((function(e){return e.destroy()})),this._sortable&&this._sortable.destroy()},t.prototype.getDirections=function(){return null},t.prototype.zoomToRoute=function(){},t.prototype.render=function(){return x.tsx("div",{class:this.classes(k,R)},this._renderPanelContent())},t.prototype._renderPanelContent=function(){var e,t=this.viewModel.state,r="initializing"===t,s="error"===t&&!this.viewModel.serviceDescription,i="unauthenticated"===t,o=((e={})[I]=r,e[P]=s,e[z]=i,e),n=r?"presentation":"group",a=i?this._renderSignIn():s?this._renderMessage(this._getErrorMessage()):r?this._renderLoader():this._renderReadyContent();return x.tsx("div",{class:this.classes(D,o),role:n},a)},t.prototype._renderReadyContent=function(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSectionSplitter(),this._renderDirectionsContainer(),this._renderDisclaimer()]},t.prototype._renderSignIn=function(){return x.tsx("div",{key:"sign-in",class:Ie},x.tsx("h2",{class:this.classes($e,ze)},n.widgetLabel),this._renderPlaceholder(),x.tsx("h3",{class:$e},n.signInRequired),x.tsx("button",{class:this.classes(Ke,Qe,Pe),tabIndex:0,onclick:this._handleSignInClick,bind:this},o.auth.signIn))},t.prototype._handleSignInClick=function(){this.viewModel.load().catch((function(){}))},t.prototype._renderTravelModeOptions=function(){var e=this.viewModel.travelModes;if(0===e.length)return null;var t=this.viewModel.selectedTravelMode,r=t.name||n.travelMode;return x.tsx("select",{"aria-label":r,bind:this,class:this.classes(A,et),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:r},e.map((function(e){var r=e.id===t.id;return x.tsx("option",{key:e,"data-mode":e,selected:r,value:e.id},e.name)})))},t.prototype._handleTravelModeChange=function(e){var t=e.currentTarget,r=t.item(t.selectedIndex);this.viewModel.selectedTravelMode=r["data-mode"]},t.prototype._renderStopsContainer=function(){return x.tsx("div",{class:N,key:"esri-directions__stops-container",role:"group"},this._renderStops())},t.prototype._renderDepartureTimeControls=function(){var e=this._departureTime===T,t=n.departureTime;return x.tsx("div",{class:L,key:"esri-directions__departure-time-controls",role:"group"},x.tsx("select",{"aria-label":t,bind:this,class:this.classes(E,et),onchange:this._handleDepartureOptionChange,title:t},x.tsx("option",{value:T,selected:e},n.leaveNow),x.tsx("option",{value:"depart-by",selected:!e},n.departBy)),e?null:this._renderTimeControls())},t.prototype._renderStops=function(){var e=this,t=this._stops,r=t.toArray().map((function(r,s){var i,o,l,c=t.length,d=s>1&&!r.result,u=((i={})[Ee]=s>=0&&s<c-1,i[Ue]=s===c-1,i),p=((o={})[K]=s===c-1,o),h=((l={})[se]=!d,l),_=t.getItemAt(c-1),v=_&&_.result,m=t.getItemAt(s+1),g=m&&m.result,f=s===c-1,y=s===c-2,S=2===c&&0===s||c>2&&!f&&!y||c>2&&y&&g||c>2&&f&&!r.result,w=2===c||3===c&&!v||d,M=e._acquireSearch(r),b=n.removeStop,T=n.reverseStops,k=n.unlocated,C=a.substitute(n.stopLabelTemplate,{number:s+1,label:r.result?r.result.name:k}),R=e.id+"__stop--"+s,D=!!M.searchTerm&&!!M.selectedResult&&!!r.result&&M.selectedResult===r.result;return x.tsx("li",{"aria-label":C,afterCreate:e._handleStopFieldCreation,bind:e,class:e.classes(te,h),id:R,key:s,"data-stop-index":s},x.tsx("div",{class:Q},x.tsx("span",{"aria-hidden":"true",class:e.classes(B,Fe,$,q)}),x.tsx("div",{bind:e,"aria-labelledby":R,class:e.classes(J,p),"data-stop-index":s,onclick:e._handleStopIconClick,onkeydown:e._handleStopIconClick,role:"button"},x.tsx("span",{class:e.classes(B,u),tabindex:D?"0":null}))),x.tsx("div",{class:X},M.render(),x.tsx("div",{class:Z})),x.tsx("div",{class:Y,role:"group"},x.tsx("div",{"aria-label":b,class:j,bind:e,"data-stop-index":s,hidden:w,onkeydown:e._handleRemoveStop,onclick:e._handleRemoveStop,role:"button",tabIndex:0,title:b},x.tsx("span",{"aria-hidden":"true",class:e.classes(B,W,Ve,q)}),x.tsx("span",{class:tt},"removeStopTitle")),x.tsx("div",{"aria-label":T,class:G,bind:e,hidden:S,onkeydown:e._handleReverseStops,onclick:e._handleReverseStops,role:"button",tabIndex:0,title:T},x.tsx("span",{"aria-hidden":"true",class:e.classes(B,Be,q)}),x.tsx("span",{class:tt},"removeStopTitle"))))})),s=t.every((function(t){var r=e._stopsToSearches.get(t);return t.result&&r.selectedResult===t.result})),i=this._stops.length>=this.maxStops,o=n.addStop,l=t.length>=2&&s&&!i?x.tsx("div",{"aria-label":o,bind:this,class:oe,key:"esri-directions__add-stop",onfocus:this._handleAddStopFocus,tabIndex:0},x.tsx("span",{"aria-hidden":"true",class:this.classes(Ne,B,q)}),x.tsx("div",{"aria-hidden":"true",class:ne},o)):null;return x.tsx("div",null,x.tsx("ol",{class:ie,role:"group",afterCreate:this._setUpDragAndDropStops},r),l)},t.prototype._handleStopIconClick=function(e){var t=e.currentTarget["data-stop-index"],r=this._stops.getItemAt(t);r&&r.result&&this._centerAtStop(r)},t.prototype._handleClearRouteClick=function(){this.viewModel.reset()},t.prototype._centerAtStop=function(e){this.viewModel.centerAt(e.result.feature)},t.prototype._handleStopFieldCreation=function(e){var t=this._newPlaceholderStop;if(t){var r=e["data-stop-index"],s=this._stops.getItemAt(r);t===s&&this._acquireSearch(s).focus(),this._newPlaceholderStop=null}},t.prototype._handleStopInputBlur=function(e,t){var r=this;this._handles.remove(rt),this.view.cursor=this._previousCursor,!!e.selectedResult&&!!t.result&&e.selectedResult===t.result||("none"!==e.activeMenu||!e.searchTerm||e.selectedResult===t.result&&(e.selectedResult||t.result)?e.searchTerm||(this._viewClickHandle.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout((function(){r.destroyed||(r._viewClickHandle.pause(),"searching"!==e.viewModel.state&&(r._removeStop(t),!!t.result&&(t.result=null,r._processStops()),r.scheduleRender()))}),this._autoStopRemovalDelay)):e.search())},t.prototype._handleStopInputFocus=function(e,t){if(!this._handles.has(rt)){var r=this.view,s=this.view.cursor;this._previousCursor=s,this._handles.add(p.init(e,"searchTerm",(function(e){r.cursor=0===e.length?"copy":s})),rt),this._activeStop=t}},t.prototype._prepViewClick=function(){var e=this,t=this.get("viewModel.view"),r=d.pausable(t,"click",this._handleViewClick.bind(this)),s=d.pausable(t.surface,"click",(function(){clearTimeout(e._autoStopRemovalTimeoutId),s.pause()}));return{remove:function(){s.remove(),r.remove()},pause:function(){s.pause(),r.pause()},resume:function(){s.resume(),r.resume()}}},t.prototype._handleViewClick=function(e){var t=this,r=this._stopsToSearches.get(this._activeStop);r&&!r.searchTerm&&(r.search(e.mapPoint).then((function(e){var s=function(e){return e.results[0].results[0]}(e),i=t._activeStop;i.result=s,i.result.feature.attributes.Name=s.name,r.searchTerm=s.name})),this.scheduleRender()),this._viewClickHandle.pause(),clearTimeout(this._autoStopRemovalTimeoutId)},t.prototype._handleAddStopFocus=function(){this._addNewPlaceholder()},t.prototype._addNewPlaceholder=function(){if(!this._newPlaceholderStop){var e={};this._stops.add(e),this._newPlaceholderStop=e}},t.prototype._handleReverseStops=function(){this._reverseStops()},t.prototype._reverseStops=function(){this._stops.reverse(),this._processStops()},t.prototype._handleRemoveStop=function(e){var t=e.currentTarget["data-stop-index"];this._removeStop(this._stops.getItemAt(t)),this._processStops()},t.prototype._removeStop=function(e,t){void 0===t&&(t=!1),this._stops.length<=2&&!t||(this._disposeSearch(e),this._stops.remove(e))},t.prototype._handleDepartureOptionChange=function(){var e=this,t=event.currentTarget,r=t.item(t.selectedIndex);r.value===T?(this._departureTime=T,this.viewModel.departureTime=T,this._handles.remove("departure-time-controls")):"depart-by"===r.value&&(this._departureTime="depart-by",this._handles.add([p.init(this._datePicker,"value",(function(){return e._updateDepartureTime()})),p.init(this._timePicker,"value",(function(){return e._updateDepartureTime()}))],"departure-time-controls"))},t.prototype._updateDepartureTime=function(){var e=this._datePicker.value,t=this._timePicker.value,r=l({date:e.date(),month:e.month(),year:e.year(),hour:t.hour(),minute:t.minute()});this.viewModel.departureTime=r.toDate()},t.prototype._renderTimeControls=function(){return x.tsx("div",{class:F,key:"esri-directions__time-controls",role:"group"},this._datePicker.render(),this._timePicker.render())},t.prototype._renderSectionSplitter=function(){return x.tsx("div",{class:Re})},t.prototype._renderDisclaimer=function(){var e='<a class="'+Je+'" href="http://www.esri.com/legal/software-license" rel="noreferrer" target="_blank">'+n.esriTerms+"</a>",t=a.substitute(n.disclaimer,{esriTerms:e});return x.tsx("div",{class:De,innerHTML:t,key:"esri-directions__disclaimer"})},t.prototype._renderDirectionsContainer=function(){return x.tsx("div",{class:this.classes(U,N),key:"esri-directions__container"},this._renderDirectionsContainerContent())},t.prototype._renderLoader=function(){return x.tsx("div",{class:H,key:"loader"})},t.prototype._renderWarningCard=function(){return x.tsx("div",{class:He,role:"alert"},x.tsx("div",{class:Oe},x.tsx("span",{class:We,"aria-hidden":"true"}),x.tsx("div",{class:this.classes($e,Ae)},o.warning)),x.tsx("div",{class:Le},this._getErrorMessage()))},t.prototype._renderDirectionsContainerContent=function(){var e=this.viewModel,t=e.lastRoute,r=e.state,s="routing"===r;return"error"===r?this._renderWarningCard():s?this._renderLoader():t?x.tsx("div",{class:V,key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):x.tsx("div",{key:"esri-directions__placeholder",class:Ye},this._renderPlaceholder(),x.tsx("h3",{class:this.classes(O,$e)},n.directionsPlaceholder))},t.prototype._renderPlaceholder=function(){return x.tsx("svg",{class:Ze,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256"},x.tsx("path",{fill:"currentcolor",d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z"}))},t.prototype._renderMessage=function(e){return x.tsx("h3",null,e)},t.prototype._renderRouteActions=function(){return x.tsx("div",{class:ue},x.tsx("button",{"aria-label":n.clearRoute,class:this.classes(C,Ke,Xe),tabIndex:0,onclick:this._handleClearRouteClick,bind:this},n.clearRoute))},t.prototype._renderManeuverSections=function(){var e=this,t=this._routeSections.sections;return x.tsx("div",{class:pe,role:"group"},t.map((function(r,s){var i,n,a,l=r.open;r.maneuvers.length>0&&l&&(a=x.tsx("ol",{class:he},r.maneuvers.map((function(t){return e._renderManeuver(t)}))));var c,d=t.length>2,u=s===t.length-1,p=((i={})[fe]=d,i),h=((n={})[qe]=!l,n[je]=l,n);if(d&&!u){var _=l?o.open:o.close;c=x.tsx("header",{class:e.classes(ve,ye),key:"esri-directions__maneuver-section-header"},x.tsx("div",{"aria-expanded":l,"aria-label":_,bind:e,class:me,"data-maneuver-section":r,onkeydown:e._handleSectionToggle,onclick:e._handleSectionToggle,role:"button",tabIndex:0,title:_},x.tsx("span",{"aria-hidden":"true",class:e.classes(h)}),x.tsx("h2",{class:e.classes($e,ge)},r.name)))}else c=x.tsx("header",{class:ve,key:"esri-directions__maneuver-section-header"},u?x.tsx("span",{"aria-hidden":"true",class:Ue}):null,x.tsx("h2",{class:e.classes($e,ge)},r.name));return x.tsx("section",{class:e.classes(_e,p)},c,a)})))},t.prototype._handleSectionToggle=function(e){var t=e.currentTarget["data-maneuver-section"];t.open=!t.open},t.prototype._renderCosts=function(){var e,t,r,s,i,o=this.get("viewModel.directionLines"),l=o[o.length-1],c=new Date(l.attributes.arriveTimeUTC),d=this._costSummary.set({directionsViewModel:this.viewModel}),u=n.zoomToRoute,p=a.formatDate(c,it),h=a.substitute(n.etaTemplate,{time:"<strong>"+p+"</strong>",gmt:(e=c,t=e.getTimezoneOffset(),r=t>0?"-":"+",s=Math.abs(Math.floor(t/60)),i=Math.abs(Math.floor(t)%60),"GMT"+r+a.formatNumber(s,ot)+a.formatNumber(i,ot))}),_=n.primaryCosts,v=n.secondaryCosts,m=n.eta;return x.tsx("div",{"aria-label":u,bind:this,class:ae,onkeydown:this._handleSummaryInteraction,onclick:this._handleSummaryInteraction,role:"button",tabIndex:0,title:u},x.tsx("div",{class:le,role:"group"},x.tsx("div",{"aria-label":_,class:ce,title:_},d.primary),x.tsx("div",{class:ee}),x.tsx("div",{"aria-label":v,class:de,title:v},d.secondary)),x.tsx("div",{"aria-label":m,innerHTML:h,title:m}))},t.prototype._handleSummaryInteraction=function(){this._activeManeuver=null,this._focusedManeuver=null,this.viewModel.clearHighlights(),this.zoomToRoute()},t.prototype._getErrorMessage=function(){var e=this.viewModel.error;return"directions-view-model:unable-to-route"===e.name?n.errors.unableToRoute:"directions-view-model:service-metadata-unavailable"===e.name?n.errors.unableToLoadServiceMetadata:n.errors.unknownError},t.prototype._normalizeSearchSources=function(e){this._overrideDefaultSources(e),this._ensureLocationTypeOnLocatorSources(e)},t.prototype._overrideDefaultSources=function(e){var t=e.view?n.searchFieldPlaceholder:n.viewlessSearchFieldPlaceholder;e.viewModel.defaultSources.forEach((function(e){e.placeholder=t,e.autoNavigate=!1}))},t.prototype._ensureLocationTypeOnLocatorSources=function(e){var t=e.allSources;0!==t.length&&t.forEach((function(e){"locator"in e&&e.locator&&null===e.locationType&&(e.locationType="street")}))},t.prototype._acquireSearch=function(e){var t=this,r=this.get("viewModel.view");if(this._stopsToSearches.has(e)){var s=this._stopsToSearches.get(e);return s.view=r,this._overrideDefaultSources(s),s}var o=new v(i({view:r,resultGraphicEnabled:!1,popupEnabled:!1},this.searchProperties));return this._normalizeSearchSources(o),this._handles.add([p.on(o,"allSources","change",(function(){return t._normalizeSearchSources(o)})),o.on("select-result",(function(){e.result=o.selectedResult,e.result.feature.attributes.Name=o.selectedResult.name,t._processStops(),t.scheduleRender()})),o.on("search-focus",(function(){return t._handleStopInputFocus(o,e)})),o.on("search-blur",(function(){return t._handleStopInputBlur(o,e)}))],o),this._stopsToSearches.set(e,o),o},t.prototype._disposeSearch=function(e){this._stopsToSearches.get(e).destroy(),this._stopsToSearches.delete(e)},t.prototype._processStops=function(){var e=this.viewModel;e.stops.removeAll(),e.stops.addMany(this._stops.filter((function(e){return!!e.result})).map((function(e){return e.result.feature}))),e.stops.length>1&&e.getDirections()},t.prototype._renderManeuver=function(e){var t,r,s=e.attributes,i=this.get("viewModel.routeParameters.directionsLengthUnits"),o=y.formatDistance(s.length,{toUnits:i}),a=y.formatTime(s.time),l=y.getAssociatedStop(e);y.useSpatiallyLocalTime(e,this.get("viewModel.routeParameters.startTime"))?r=y.toSpatiallyLocalTimeString(s.arriveTimeUTC,s.ETA,this._departureTime===T):o&&(r=a?o+"&nbsp;&middot;&nbsp;"+a:o);var c=l,d=this._getFormattedManeuverText(e),u=this._getIconPath(s.maneuverType);if(c)return x.tsx("li",{class:Se,key:e},x.tsx("header",null,l.attributes.Name));var p="esri-directions__maneuver-"+e.uid,h="esri-directions__cumulative-costs-"+e.uid,_="esri-directions__intermediate-costs-"+e.uid,v=((t={})[we]=this._activeManeuver===e,t);return x.tsx("li",{"aria-labelledby":p+" "+h+" "+_,bind:this,class:this.classes(Se,v),"data-maneuver":e,key:e,onclick:this._handleManeuverClick,onkeydown:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onmouseover:this._handleManeuverMouseOver,onmouseout:this._handleManeuverMouseOut,onblur:this._handleManeuverBlur,tabIndex:0},x.tsx("img",{alt:"",class:xe,src:u}),x.tsx("div",{class:be},x.tsx("span",{id:p,innerHTML:d}),x.tsx("div",{class:Me},x.tsx("div",{class:Ce}),x.tsx("div",{id:h,"aria-label":n.cumulativeCosts,class:Te,innerHTML:"",title:n.cumulativeCosts}),x.tsx("div",{id:_,"aria-label":n.intermediateCosts,class:ke,innerHTML:r,title:n.intermediateCosts}))))},t.prototype._getIconPath=function(e){var t=S.toIconName(e),r=2===window.devicePixelRatio?"@2x":"";return""+st+t+r+".png"},t.prototype._handleManeuverClick=function(e){var t=e.currentTarget["data-maneuver"];if(this._activeManeuver===t)return this._activeManeuver=null,void this.zoomToRoute();this._activeManeuver=t,this.viewModel.centerAt(t),this.viewModel.highlightSegment(t)},t.prototype._handleManeuverMouseOver=function(e){if(!this._activeManeuver&&!this._focusedManeuver){var t=e.currentTarget["data-maneuver"];this.viewModel.highlightSegment(t)}},t.prototype._handleManeuverMouseOut=function(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()},t.prototype._handleManeuverBlur=function(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())},t.prototype._handleManeuverFocus=function(e){if(!this._activeManeuver){var t=e.currentTarget["data-maneuver"];this._focusedManeuver=t,this.viewModel.highlightSegment(t)}},t.prototype._getFormattedManeuverText=function(e){var t=e.attributes.text,r=e.strings;if(!r)return t;var s=t;return r.forEach((function(e){s=s.replace(e.string,"<strong>"+e.string+"</strong>")})),s},s([h.aliasOf("viewModel.goToOverride")],t.prototype,"goToOverride",void 0),s([h.property()],t.prototype,"iconClass",void 0),s([h.property()],t.prototype,"label",void 0),s([h.aliasOf("viewModel.lastRoute")],t.prototype,"lastRoute",void 0),s([h.aliasOf("viewModel.maxStops")],t.prototype,"maxStops",void 0),s([h.aliasOf("viewModel.routeServiceUrl")],t.prototype,"routeServiceUrl",void 0),s([h.aliasOf("viewModel.routeSymbol")],t.prototype,"routeSymbol",void 0),s([h.property()],t.prototype,"searchProperties",void 0),s([h.aliasOf("viewModel.stopSymbols")],t.prototype,"stopSymbols",void 0),s([h.aliasOf("viewModel.view")],t.prototype,"view",void 0),s([x.renderable(["lastRoute","state","travelModes"]),h.property({type:g})],t.prototype,"viewModel",void 0),s([h.aliasOf("viewModel.getDirections")],t.prototype,"getDirections",null),s([h.aliasOf("viewModel.zoomToRoute")],t.prototype,"zoomToRoute",null),s([x.accessibleHandler()],t.prototype,"_handleStopIconClick",null),s([x.accessibleHandler()],t.prototype,"_handleClearRouteClick",null),s([x.accessibleHandler()],t.prototype,"_handleReverseStops",null),s([x.accessibleHandler()],t.prototype,"_handleRemoveStop",null),s([x.accessibleHandler()],t.prototype,"_handleSectionToggle",null),s([x.accessibleHandler()],t.prototype,"_handleSummaryInteraction",null),s([x.accessibleHandler()],t.prototype,"_handleManeuverClick",null),t=s([h.subclass("esri.widgets.Directions")],t)}(h.declared(m))}));