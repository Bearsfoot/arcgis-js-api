// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.15/esri/copyright.txt for details.

define(["require","exports","../core/tsSupport/assignHelper","../core/tsSupport/declareExtendsHelper","../core/tsSupport/decorateHelper","dojo/i18n!./FeatureTable/nls/FeatureTable","../intl","../core/HandleOwner","../core/watchUtils","../core/accessorSupport/decorators","./Widget","./FeatureTable/FeatureTableViewModel","./support/widget"],(function(e,t,i,r,n,s,o,l,a,u,d,c,h){var p={header:!0,menu:!0,menuItems:{clearSelection:!0,refreshData:!0,toggleColumns:!0}},m="esri-feature-table",_="esri-feature-table__header",f="esri-feature-table__title",v="esri-feature-table__content",b="esri-feature-table__loader",g="esri-feature-table__loader-container",y="esri-feature-table__menu",w="esri-feaute-table__menu-anchor",M="esri-feature-table__menu-content",x="esri-feature-table__menu-accordion",C="esri-feature-table__menu-accordion-sub",k="esri-feature-table__menu-item",E="esri-feature-table__menu-item-label",I="esri-feature-table__menu-item-label__content",T="esri-feature-table__menu-input",S="esri-feature-table__menu-item__icon",O="esri-feature-table__menu-item__input",R="esri-feature-table__button",F="esri-feature-table__button--selected",H="esri-icon-menu",A="esri-icon-right",B="esri-icon-check-mark",j="esri-widget";return function(e){function t(t){var r=e.call(this,t)||this;return r._menuActive=!1,r.attachmentsEnabled=null,r.fieldConfigs=null,r.grid=null,r.label=s.widgetLabel,r.layer=null,r.viewModel=new c,r.visibleElements=i({},p),r}return r(t,e),t.prototype.postInitialize=function(){var e=this;this.handles.add([a.on(this,"grid.selectedItems","change",(function(t){return e._onSelectionChange(t)})),a.watch(this,["viewModel.store.querying","viewModel.store.syncing","grid.size"],(function(){return e.scheduleRender()}))])},t.prototype.castVisibleElements=function(e){return i({},p,e)},t.prototype.render=function(){return h.tsx("div",{bind:this,class:this.classes(m,j)},this.visibleElements.header?this._renderHeader():null,h.tsx("div",{class:v},"disabled"!==this.state&&this.grid&&this.grid.render()))},t.prototype.sortColumn=function(e,t){this.viewModel&&this.viewModel.sortColumn(e,t)},t.prototype.showColumn=function(e){this.grid&&this.grid.showColumn(e)},t.prototype.hideColumn=function(e){this.grid&&this.grid.hideColumn(e)},t.prototype.clearSelection=function(){this.grid&&this.grid.clearSelection()},t.prototype.refresh=function(){this.grid&&this.grid.refresh()},t.prototype._selectRow=function(e){var t=this.viewModel;if(t){var i=t.store,r=i&&i.getIndexForObjectId(e);this.grid&&this.grid.selectRow(r)}},t.prototype._deselectRow=function(e){var t=this.viewModel;if(t){var i=t.store,r=i&&i.getIndexForObjectId(e);this.grid&&this.grid.deselectRow(r)}},t.prototype._renderHeader=function(){return h.tsx("div",{key:"header",class:_},this._renderLoader(),this._renderTitle(),this._renderMenu())},t.prototype._renderTitle=function(){return h.tsx("div",{class:f,key:"title"},this._getTitle())},t.prototype._getTitle=function(){var e=this.grid,t=this.layer.title,i=this.viewModel.size;return e?o.substitute(s.header,{title:t,count:i,selected:e.selectedItems.length||0}):""},t.prototype._renderLoader=function(){var e=this.viewModel,t=e.state,i=e.store,r="loading"===t||i.syncing||i.querying;return h.tsx("div",{class:g},r?h.tsx("div",{class:b,key:"loader"}):null)},t.prototype._renderMenu=function(){if(this.visibleElements.menu)return h.tsx("div",{class:y,key:"menu"},h.tsx("div",{class:w},this._renderMenuButton(),this._renderMenuContent()))},t.prototype._renderMenuButton=function(){var e=s.menu,t=this.classes([R,H,this._menuActive?F:null]);return h.tsx("button",{"aria-label":e,bind:this,class:t,title:e,selected:this._menuActive,onclick:this._onMenuButtonClick})},t.prototype._renderMenuContent=function(){var e=this.visibleElements.menuItems,t=e.clearSelection,i=e.refreshData,r=e.toggleColumns;return h.tsx("div",{class:M,bind:this,hidden:!this._menuActive},h.tsx("ul",{class:x,role:"menu"},t?this._renderMenuItem(s.clearSelection,this.clearSelection):null,i?this._renderMenuItem(s.refreshData,this.refresh):null,r?this._renderColumnToggleMenuItemGroup():null))},t.prototype._renderMenuItem=function(e,t){return h.tsx("li",{class:k,role:"menuitem"},h.tsx("button",{bind:this,onclick:t,class:this.classes(R,E)},h.tsx("span",{class:I},e)))},t.prototype._renderColumnToggleMenuItemGroup=function(){var e=this.id+"-menu-group";return h.tsx("li",{class:k,role:"menuitem"},h.tsx("input",{class:T,type:"checkbox",name:e,id:e}),h.tsx("label",{class:E,for:e},h.tsx("span",{class:this.classes(I,A),"aria-hidden":!0}),h.tsx("span",{class:I},s.toggleColumns)),this._renderColumnToggleMenuItem())},t.prototype._renderColumnToggleMenuItem=function(){var e=this,t=this.id,i=this.viewModel.columns;return h.tsx("ul",{class:C},i&&i.items.map((function(i){var r=i.header,n=i.hidden,s=i.path,o=t+"-menu-item-"+s;return h.tsx("li",{key:o,class:k},h.tsx("a",{class:E},h.tsx("input",{class:O,type:"checkbox",name:o,id:o,checked:!n,onchange:function(t){var i=t.target;return e._onColumnCheckboxChange(s,i)}}),h.tsx("label",{for:o,class:e.classes(S,n?null:B)}),h.tsx("label",{class:E,for:o},r||s)))})))},t.prototype._onColumnCheckboxChange=function(e,t){t&&t.checked?this.showColumn(e):this.hideColumn(e)},t.prototype._onMenuButtonClick=function(){this._menuActive=!this._menuActive},t.prototype._onSelectionChange=function(e){var t=e.added,i=e.removed;this.emit("selection-change",{added:t.slice(),removed:i.slice()})},n([u.aliasOf("viewModel.attachmentsEnabled")],t.prototype,"attachmentsEnabled",void 0),n([u.aliasOf("viewModel.fieldConfigs")],t.prototype,"fieldConfigs",void 0),n([u.aliasOf("viewModel.grid")],t.prototype,"grid",void 0),n([u.property()],t.prototype,"label",void 0),n([u.aliasOf("viewModel.layer")],t.prototype,"layer",void 0),n([u.aliasOf("viewModel.relatedRecordsEnabled")],t.prototype,"relatedRecordsEnabled",void 0),n([u.aliasOf("viewModel.state")],t.prototype,"state",void 0),n([u.property(),h.renderable(["viewModel.attachmentsEnabled","viewModel.layer","viewModel.relatedRecordsEnabled","viewModel.state"])],t.prototype,"viewModel",void 0),n([u.property(),h.renderable()],t.prototype,"visibleElements",void 0),n([u.cast("visibleElements")],t.prototype,"castVisibleElements",null),t=n([u.subclass("esri.widgets.FeatureTable")],t)}(u.declared(l.HandleOwnerMixin(d)))}));