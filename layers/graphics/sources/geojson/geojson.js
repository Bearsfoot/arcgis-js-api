// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.15/esri/copyright.txt for details.

define(["require","exports","../../../../core/tsSupport/generatorHelper","../../../../core/tsSupport/awaiterHelper","../../../../core/tsSupport/valuesHelper","../../../../core/Error","../../OptimizedFeature","../../OptimizedGeometry"],(function(e,r,t,n,o,u,a,i){Object.defineProperty(r,"__esModule",{value:!0});var s={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function l(e){var r,n,o;return t(this,(function(t){switch(t.label){case 0:switch(e.type){case"Feature":return[3,1];case"FeatureCollection":return[3,3]}return[3,7];case 1:return[4,e];case 2:return t.sent(),[3,7];case 3:r=0,n=e.features,t.label=4;case 4:return r<n.length?(o=n[r])?[4,o]:[3,6]:[3,7];case 5:t.sent(),t.label=6;case 6:return r++,[3,4];case 7:return[2]}}))}function c(e,r){var n,o,u,l,c,f,p,h;return void 0===r&&(r={}),t(this,(function(t){switch(t.label){case 0:n=r.geometryType,o=r.objectIdFieldName,t.label=1;case 1:return u=e.next(),l=u.value,u.done?[2]:(c=l.geometry,f=l.properties,p=l.id,c&&s[c.type]!==n?[3,1]:(h=f||{},o&&null!=p&&(h[o]=p),[4,new a.default(c?function(e,r,t){switch(r.type){case"LineString":return function(e,r,t){return g(e,r.coordinates,t),e}(e,r,t);case"MultiLineString":return function(e,r,t){for(var n=0,o=r.coordinates;n<o.length;n++){var u=o[n];g(e,u,t)}return e}(e,r,t);case"MultiPoint":return function(e,r,t){return g(e,r.coordinates,t),e}(e,r,t);case"MultiPolygon":return function(e,r,t){for(var n=0,o=r.coordinates;n<o.length;n++){var u=o[n];d(e,u[0],t);for(var a=1;a<u.length;a++)y(e,u[a],t)}return e}(e,r,t);case"Point":return function(e,r,t){return v(e,r.coordinates,t),e}(e,r,t);case"Polygon":return function(e,r,t){var n=r.coordinates;d(e,n[0],t);for(var o=1;o<n.length;o++)y(e,n[o],t);return e}(e,r,t)}}(new i.default,c,r):null,h)]));case 2:return t.sent(),[3,1];case 3:return[2]}}))}function f(e){for(var r=0,t=0;t<e.length;t++){var n=e[t],o=e[(t+1)%e.length];r+=n[0]*o[1]-o[0]*n[1]}return r<=0}function p(e){var r=e[0],t=e[e.length-1];return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]||e.push(r),e}function d(e,r,t){var n=p(r);f(n)?g(e,n,t):h(e,n,t)}function y(e,r,t){var n=p(r);f(n)?h(e,n,t):g(e,n,t)}function g(e,r,t){for(var n=0,o=r;n<o.length;n++){v(e,o[n],t)}e.lengths.push(r.length)}function h(e,r,t){for(var n=r.length-1;n>=0;n--)v(e,r[n],t);e.lengths.push(r.length)}function v(e,r,t){var n=r[0],o=r[1],u=r[2];e.coords.push(n,o),t.hasZ&&e.coords.push(u||0)}function m(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}r.validateGeoJSON=function(e){if(!e)throw new u("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new u("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});if(e.crs){var r=e.crs;if("link"===r.type||!["crs84","4326"].some((function(e){return-1!==r.properties.name.toLowerCase().indexOf(e)})))throw new u("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:r})}},r.inferLayerProperties=function(e,r){void 0===r&&(r={});for(var n=l(e),u=[],a=new Set,i=new Set,c=!1,f=Number.NEGATIVE_INFINITY,p=null,d=!1,y=void 0,g=r.geometryType,h=void 0===g?null:g,v=!1,b=function(){var e,r,l=n.next(),g=l.value;if(l.done){var b=p&&1===p.length&&p[0]||null;if(b)for(var w=0,P=u;w<P.length;w++){var S=P[w];S.name===b&&(S.type="esriFieldTypeOID")}return{value:{fields:u,geometryType:h,hasZ:c,maxObjectId:Math.max(0,f),objectIdFieldName:b,objectIdFieldType:y,unknownFields:(e=i,r=[],e.forEach((function(e){return r.push(e)})),r)}}}var F=g.geometry,j=g.properties,M=g.id;if(F&&(h||(h=s[F.type]),s[F.type]!==h))return"continue";if(!c){var G=function(e){var r,n,u,a,i,s,l,c,f;return t(this,(function(t){switch(t.label){case 0:if(!e)return[2,null];switch(e.type){case"Point":return[3,1];case"LineString":case"MultiPoint":return[3,3];case"MultiLineString":case"Polygon":return[3,5];case"MultiPolygon":return[3,10]}return[3,17];case 1:return[4,e.coordinates];case 2:return t.sent(),[3,17];case 3:return[5,o(e.coordinates)];case 4:return t.sent(),[3,17];case 5:r=0,n=e.coordinates,t.label=6;case 6:return r<n.length?(u=n[r],[5,o(u)]):[3,9];case 7:t.sent(),t.label=8;case 8:return r++,[3,6];case 9:return[3,17];case 10:a=0,i=e.coordinates,t.label=11;case 11:if(!(a<i.length))return[3,16];s=i[a],l=0,c=s,t.label=12;case 12:return l<c.length?(f=c[l],[5,o(f)]):[3,15];case 13:t.sent(),t.label=14;case 14:return l++,[3,12];case 15:return a++,[3,11];case 16:return[3,17];case 17:return[2]}}))}(F);c=function(e){for(;;){var r=e.next(),t=r.value;if(r.done)return!1;if(t.length>2)return!0}}(G)}if(d||(d=null!=M)&&"number"===(y=typeof M)&&(p=Object.keys(j).filter((function(e){return j[e]===M}))),d&&"number"===y&&null!=M&&(f=Math.max(f,M),p.length>1?p=p.filter((function(e){return j[e]===M})):1===p.length&&(p=j[p[0]]===M?p:[])),!v&&j){var O=!0;for(var N in j)if(!a.has(N)){var x=j[N];if(null!=x){var I=m(x);"unknown"!==I?(i.delete(N),a.add(N),u.push({name:N,alias:N,type:I})):i.add(N)}else O=!1,i.add(N)}v=O}};;){var w=b();if("object"==typeof w)return w.value}},r.createOptimizedFeatures=function(e,r){return function(e){for(var r=[];;){var t=e.next(),n=t.value;if(t.done)return r;r.push(n)}}(c(l(e),r))}}));